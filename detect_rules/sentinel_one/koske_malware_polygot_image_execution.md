### Koske Malware: AI-Assisted Polyglot Threat
---

The Koske malware is a sophisticated Linux-based threat that leverages AI-generated code and polyglot image files to conduct stealthy cryptocurrency mining operations. It evades detection by hiding malicious payloads within seemingly benign images and executing code directly in memory, making it a significant challenge for traditional security measures.

Recent intelligence highlights Koske's advanced adaptive capabilities, including its use of AI to dynamically adjust its behavior, such as self-correcting C2 communication issues by altering proxy settings and DNS configurations. This AI-driven adaptability and the use of polyglot files for stealthy payload delivery represent a notable evolution in Linux malware, making it more resilient and harder to attribute.

### Actionable Threat Data
---

Monitor for the execution of grep piped to bash (e.g., grep -a -A9999 "# PAYLOAD" polyglot.jpg | bash), as this is a core technique used by Koske to execute embedded payloads from polyglot files.

Detect unusual modifications to system persistence mechanisms, such as .bashrc, crontab entries, or the creation of new systemd services, which Koske abuses to maintain access.

Look for the creation or modification of /etc/ld.so.preload or the use of the LD_PRELOAD environment variable, as Koske deploys rootkits using this technique to hide its presence.

Identify suspicious network connections initiated by curl or wget to unusual or newly observed IP addresses or domains, especially when originating from temporary directories or unexpected processes, indicating C2 communication or payload download.

Monitor for sudden and sustained spikes in CPU or GPU utilization on Linux systems, which could indicate the presence of unauthorized cryptocurrency mining activity.

### Combined Analysis Search
---
```sql
-- Name: Suspicious Linux Activity Associated with Koske Malware
-- Author: RW
-- Date: 2025-08-24
-- Description: This detection rule identifies multiple behaviors associated with the Koske malware on Linux systems. It combines several detection techniques into a single query, looking for polyglot file execution, persistence mechanism abuse, rootkit deployment, and suspicious C2 communications. An alert from this rule indicates one or more potentially malicious activities have occurred on a host and warrants investigation.
-- Data Source: Requires SentinelOne agent telemetry for Linux endpoints.

osFamily = "Linux" AND (
  -- TTP 1: Process-based detection
  (
    (processName IN ("grep", "egrep") AND cmdLine MATCHES ".*\\|.*(sh|bash)")
    OR (processName = "systemctl" AND cmdLine MATCHES ".*enable.*\\.service")
    OR (cmdLine MATCHES ".*LD_PRELOAD=.*")
    OR (processName IN ("curl", "wget"))
  )
  -- TTP 2: File-based detection
  OR (
    eventType IN ("File Creation", "File Modification")
    AND filePath IN ("*/.bashrc", "/etc/crontab", "/etc/cron.d/*", "/etc/systemd/system/*.service", "/etc/ld.so.preload")
  )
)
-- Exclude benign activities
AND NOT (userName IN ("puppet", "ansible") OR parentProcessName IN ("yum", "apt-get"))
| SELECT
    timestamp AS _time,
    endpointName AS host,
    userName AS user,
    CASE
      WHEN processName IN ("grep", "egrep") THEN "Polyglot Execution (grep | shell)"
      WHEN processName = "systemctl" THEN "Persistence: Systemd Service Enabled"
      WHEN cmdLine MATCHES ".*LD_PRELOAD=.*" THEN "Rootkit: LD_PRELOAD Env Var Used"
      WHEN processName IN ("curl", "wget") THEN "Suspicious C2 (curl/wget execution)"
      WHEN filePath = "/etc/ld.so.preload" THEN "Rootkit: ld.so.preload Modified"
      ELSE "Persistence: Common File Modified"
    END AS detection_reason,
    COALESCE(cmdLine, filePath) AS event_detail,
    COUNT(*) AS event_count
| GROUP BY _time, host, user
```