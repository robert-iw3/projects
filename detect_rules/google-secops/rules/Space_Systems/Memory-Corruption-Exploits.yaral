rule potential_memory_corruption_exploit_on_mission_software {
  meta:
    author = "RW"
    date = "2025-08-18"
    description = "Detects multiple application crashes of critical space mission software within a short time frame. This pattern can indicate an adversary attempting to exploit a memory corruption vulnerability (e.g., heap/buffer overflow, memory leak) for denial of service or arbitrary code execution. This is based on research disclosing critical vulnerabilities in NASA's fprime and CryptoLib frameworks."
    false_positive_sensitivity = "Medium"
    references = "https://visionspace.com/remote-code-execution-and-critical-vulnerabilities-in-nasa-fprime-v3-4-3/, https://visionspace.com/crashing-cryptolib/, https://securitybynature.fr/post/hacking-cryptolib/, https://github.com/nasa/CryptoLib/security, https://www.blackhat.com/us-25/briefings/schedule/#burning-trashing-spacecraft-crashing-a-collection-of-vulnerabilities-that-will-end-your-space-mission-41536"
    tactic = "TA0040, TA0004"
    technique = "T1499, T1068"

  events:
    // Filter for Windows Application Crash events (Event ID 1000).
    // This is often mapped to the APPLICATION_UNCATEGORIZED event type in UDM.
    $e.metadata.event_type = "APPLICATION_UNCATEGORIZED"
    $e.metadata.product_event_type = "1000"
    $e.metadata.vendor_name = "Microsoft"
    $e.metadata.product_name = "Windows"

    // FP Tuning: Update this regex with the specific process names for fprime,
    // CryptoLib-dependent apps, or other critical mission software in your environment.
    re.regex($e.target.process.file.full_path, `(?i)(\\fprime-gds\.exe|\\yamcs\.exe|\\openc3\.exe|\\mission_control\.exe)$`)

    // Placeholder variables for matching and outcome.
    $hostname = $e.principal.hostname
    $process_name = $e.target.process.file.full_path
    // The faulting module path is often included in the event description.
    $faulting_module_info = $e.security_result.description

  match:
    // Correlate multiple crashes of the same process on the same host over 1 hour.
    $hostname, $process_name over 1h

  outcome:
    $risk_score = 80
    $detection_name = "Potential Memory Corruption Exploit on Mission Software"
    $description_out = "Multiple application crashes observed for a critical space mission process [" + $process_name + "] on host [" + $hostname + "], which may indicate an attempt to exploit a memory corruption vulnerability."

    // FP Tuning: Adjust crash count threshold. Some applications may be unstable and crash occasionally due to bugs.
    // A value > 1 is recommended to detect repeated exploitation attempts.
    $crash_threshold = 1
    $crash_count = count($e.metadata.id)

    $principal_hostname = $hostname
    $target_process_path = $process_name
    $faulting_module_details = array_distinct($faulting_module_info)
    $principal_ips = array_distinct($e.principal.ip)

  condition:
    // Alert if the number of crashes exceeds the defined threshold.
    $crash_count > $crash_threshold
}
