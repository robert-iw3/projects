rule UAT_7237_All_In_One_IOC_Detection {

  meta:
    author = "RW"
    creation_date = "2025-08-16"
    last_modified_date = "2025-08-16"
    description = "Detects various Indicators of Compromise (IOCs) associated with UAT-7237 activity, including file hashes, IP addresses, domains, and URLs."
    // False Positive Sensitivity: Medium
    // The IP address IOC is high-fidelity but may become a false positive if re-assigned by the provider.
    reference = "https://blog.talosintelligence.com/uat-7237-targets-web-hosting-infra/"
    mitre_tactic = "TA0002, TA0011"
    mitre_technique = "T1204, T1105, T1071.001"

  events:
    // Define the list of malicious file hashes from the UAT-7237 report.
    $hash_list = {
      "df8497b9c37b780d6b6904a24133131faed8ea4cf3d75830b53c25d41c5ea386",
      "0952e5409f39824b8a630881d585030a1d656db897adf228ce27dd9243db20b7",
      "7a5f05da3739ad3e11414672d01b8bcf23503a9a8f1dd3f10ba2ead7745cdb1f",
      "450fa9029c59af9edf2126df1d6a657ee6eb024d0341b32e6f6bdb8dc04bae5a",
      "6a72e4b92d6a459fc2c6054e9ddb9819d04ed362bd847333492410b6d7bae5aa",
      "e106716a660c751e37cfc4f4fbf2ea2f833e92c2a49a0b3f40fc36ad77e0a044",
      "b52bf5a644ae96807e6d846b0ce203611d83cc8a782badc68ac46c9616649477",
      "864e67f76ad0ce6d4cc83304af4347384c364ca6735df0797e4b1ff9519689c5"
    }

    // Match process creation events where the file hash is in the IOC list.
    $process.metadata.event_type = "PROCESS_LAUNCH"
    and $process.target.file.sha256 in $hash_list

    // Match network connections to the malicious IP, domain, or URL.
    $network.metadata.event_type = "NETWORK_CONNECTION"
    and (
      $network.target.ip = "141.164.50.141" or
      strings.contains($network.target.url, "cvbbonwxtgvc3isfqfc52cwzja0kvuqd.lambda-url.ap-northeast-1.on.aws") or
      $network.target.url = "http://141.164.50.141/sdksdk608/win-x64.rar"
    )

  condition:
    // Trigger a detection if either a malicious process or network connection is found.
    $process or $network
}