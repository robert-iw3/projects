// title: RattyRAT Malware Activity
// description: Detects the execution of a Java process launching a JAR file with 'ratty' in the name, which is indicative of the RattyRAT remote access trojan. RattyRAT is a Java-based RAT known to be used by the threat group Scattered Spider for persistence and reconnaissance.
// author: RW
// date: 2025-07-31
// references:
//   - https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-320a
// tags:
//   - attack.t1219
//   - group.scattered_spider

DeviceProcessEvents
| where TimeGenerated > ago(1d)
// --_comment: Filter for Java runtime process executions.
| where FileName in~ ("java.exe", "javaw.exe")
// --_comment: Look for command-line arguments indicating the execution of a JAR file containing "ratty", the name of the RAT.
| where ProcessCommandLine has "-jar" and ProcessCommandLine contains "ratty"
// --_comment: Tuning: This detection is specific to the name "RattyRAT". To broaden detection for other suspicious Java executions, consider looking for JAR files executed from unusual locations (e.g., C:\Users\, C:\Windows\Temp\) or spawned by non-standard parent processes (e.g., winword.exe, outlook.exe).
| project-reorder
    TimeGenerated,
    DeviceName,
    AccountName,
    FileName,
    ProcessCommandLine,
    FolderPath,
    InitiatingProcessFileName,
    InitiatingProcessCommandLine,
    MD5,
    SHA256
