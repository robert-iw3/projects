### MongoBleed (CVE-2025-14847) Information Leak
---

A high-severity vulnerability nicknamed MongoBleed (CVE-2025-14847) allows unauthenticated attackers to remotely leak sensitive memory from vulnerable MongoDB servers. This flaw is being actively exploited in the wild, making it critical for organizations with self-hosted instances to take immediate action.

Exploitation of MongoBleed can be detected by identifying distinct behavioral anomalies in server logs. Unlike legitimate connections, the exploit generates massive connection bursts (50,000-100,000 per minute) from a single source IP and fails to send client metadata (event ID 51800), providing a high-fidelity method for creating detections. An open-source log analysis tool is now available to help defenders scan for these specific indicators of compromise.

### Actionable Threat Data
---

Exploitation involves sending a malformed, compressed network packet that causes the server to return uninitialized heap memory before authentication is performed.

Detection efforts should focus on monitoring MongoDB logs for an unusually high number of rapid connections and disconnections from a single IP address that lack corresponding client metadata (event ID 51800).

Look for CPU and memory spikes correlated with large data requests from an unauthenticated IP address. Enabling verbose command logging may reveal BSON parsing errors associated with exploit attempts.

Affected MongoDB server versions include 8.2.0-8.2.2, 8.0.0-8.0.16, 7.0.0-7.0.27, 6.0.0-6.0.26, 5.0.0-5.0.31, 4.4.0-4.4.29, and all end-of-life versions (4.2, 4.0, 3.6).

As a temporary mitigation if patching is not possible, disable zlib compression by explicitly omitting "zlib" from the networkMessageCompressors or net.compression.compressors server configuration.

### MongoBleed High Connection Rate
---

```sql
-- MongoBleed High Connection Rate
-- Detects very high number of connections per minute from single source IP to MongoDB (27017)

FROM network-traffic*
| WHERE destination.port == 27017
| EVAL minute = DATE_TRUNC("minute", @timestamp)
| STATS connection_count = COUNT(*) BY minute, source.ip, destination.ip
| WHERE connection_count >= 1000

-- Optional: exclude known legitimate IPs/subnets
-- | WHERE source.ip NOT IN ("10.1.1.0/24", "172.16.0.0/16", "::1", "127.0.0.1")

| SORT minute DESC
| LIMIT 500

-- Suggested columns for alert
| KEEP minute, source.ip AS src_ip, destination.ip AS dest_ip, connection_count
```

### MongoBleed Missing Client Metadata
---

```sql
-- MongoBleed Missing Client Metadata (high fidelity IOC)
-- Looks for connections that open and close without sending client metadata (id:51800)

FROM "logs-mongodb-*", mongodb-logs*
| WHERE message LIKE "%connection accepted%"
   OR message LIKE "%end connection%"
   OR mongodb.id == 51800
   OR message LIKE "%client metadata%"

| EVAL
    conn_id = TO_STRING(REGEXP_EXTRACT(message, r"\[conn(\d+)\]", 1)),
    src_ip = REGEXP_EXTRACT(message, r"connection accepted from ([^:]+):", 1),

    is_accepted  = CASE(message LIKE "%connection accepted%", 1, 0),
    is_ended     = CASE(message LIKE "%end connection%", 1, 0),
    has_metadata = CASE(mongodb.id == 51800 OR message LIKE "%client metadata%", 1, 0)

| WHERE conn_id IS NOT NULL

| STATS
    src_ip = ANY(src_ip),
    accepted_count  = SUM(is_accepted),
    ended_count     = SUM(is_ended),
    metadata_count  = SUM(has_metadata)
  BY conn_id

| WHERE accepted_count > 0
   AND ended_count > 0
   AND metadata_count == 0

| EVAL src_ip = COALESCE(src_ip, "unknown")

| STATS
    suspicious_connections = COUNT(*)
  BY src_ip

| WHERE suspicious_connections >= 10

| SORT suspicious_connections DESC

| RENAME
    src_ip AS "Source IP",
    suspicious_connections AS "Suspicious Connection Count"

-- Variant A - more strict message matching
--| WHERE message RLIKE "(?i)connection accepted|(?i)end connection|id.*51800"

-- Variant B - when connection id is in different format
--| EVAL conn_id = REGEXP_EXTRACT(message, r"conn(\d+)", 1)
```

### MongoBleed Vulnerable Configuration
---

```sql
-- MongoBleed Vulnerable Configuration Check
-- Looks for active zlib compression in mongod.conf files

FROM filebeat-*, logs-*, auditbeat-*
| WHERE
    (file.path LIKE "%mongod.conf"
     OR file.name == "mongod.conf"
     OR event.dataset IN ("mongodb.config", "config.mongod"))
    AND message IS NOT NULL

-- Look for uncommented zlib references in compression settings
| WHERE
    REGEXP_LIKE(
      message,
      """(?im)^\\s*[^#].*(networkMessageCompressors\\s*:\\s*.*zlib|compressors\\s*:\\s*.*zlib|enabled:\\s*true.*zlib)"""
    )

| STATS
    config_files = COUNT_DISTINCT(file.path),
    first_seen = MIN(@timestamp),
    last_seen = MAX(@timestamp)
  BY
    host.name,
    agent.name,
    file.path

| SORT last_seen DESC

| RENAME
    host.name AS "Host",
    file.path AS "Configuration File",
    config_files AS "Match Count"
```