{
  "rule_id": "ccp_network_device_exploitation_ttps",
  "name": "CCP Network Device Exploitation TTPs",
  "description": "Detects TTPs associated with CCP actors targeting network infrastructure, including enabling backdoors, modifying ACLs, creating users, and capturing traffic. This includes suspicious SSH activity on high ports, unauthorized ACL changes, user creation, and packet capture commands or files.",
  "severity": "high",
  "enabled": true,
  "language": "esql",
  "query": "FROM logs-cisco*,logs-paloalto*,logs-linux*,logs-firewall* WHERE (process.command_line LIKE '%service sshd_operns start%' OR process.command_line LIKE '%access-list 10%' OR process.command_line LIKE '%access-list 20%' OR process.command_line LIKE '%access-list 50%' OR process.command_line LIKE '%useradd cisco%' OR process.command_line LIKE '%vi /etc/sudoers%' OR process.command_line LIKE '%monitor capture%' OR process.command_line LIKE '%span%' OR process.command_line LIKE '%erspan%' OR file.name LIKE '%mycap.pcap' OR file.name LIKE '%tac.pcap' OR file.name LIKE '%1.pcap' OR destination.port = 57722 OR destination.port MATCHES '^\\\\d{3,5}22$') | EVAL reason = CASE( process.command_line LIKE '%service sshd_operns start%', 'Suspicious Service Started: sshd_operns', process.command_line LIKE '%access-list 10%' OR process.command_line LIKE '%access-list 20%' OR process.command_line LIKE '%access-list 50%', 'Suspicious ACL Modification Detected', process.command_line LIKE '%useradd cisco%', 'Suspicious User Creation: cisco', process.command_line LIKE '%vi /etc/sudoers%', 'Sudoers File Edited', process.command_line LIKE '%monitor capture%' OR process.command_line LIKE '%span%' OR process.command_line LIKE '%erspan%', 'Packet/Traffic Capture Command Detected', file.name LIKE '%mycap.pcap' OR file.name LIKE '%tac.pcap' OR file.name LIKE '%1.pcap', 'Suspicious PCAP Filename Detected', destination.port = 57722, 'Network Connection to IOS XR Backdoor Port 57722', destination.port MATCHES '^\\\\d{3,5}22$', 'Network Connection to High Port Ending in ''22''', true, 'Unknown Match - Check Raw Event' ) | KEEP @timestamp, reason, user.name, source.ip, destination.ip, destination.port, process.command_line, file.name, event.original | SORT @timestamp DESC",
  "type": "esql",
  "threat": [
    {
      "framework": "MITRE ATT&CK",
      "tactic": {
        "id": "TA0003",
        "name": "Persistence",
        "reference": "https://attack.mitre.org/tactics/TA0003/"
      },
      "technique": [
        {
          "id": "T1021.004",
          "name": "Remote Services: SSH",
          "reference": "https://attack.mitre.org/techniques/T1021/004/"
        },
        {
          "id": "T1136.001",
          "name": "Create Account: Local Account",
          "reference": "https://attack.mitre.org/techniques/T1136/001/"
        }
      ]
    },
    {
      "framework": "MITRE ATT&CK",
      "tactic": {
        "id": "TA0005",
        "name": "Defense Evasion",
        "reference": "https://attack.mitre.org/tactics/TA0005/"
      },
      "technique": [
        {
          "id": "T1562.004",
          "name": "Impair Defenses: Disable or Modify System Firewall",
          "reference": "https://attack.mitre.org/techniques/T1562/004/"
        }
      ]
    },
    {
      "framework": "MITRE ATT&CK",
      "tactic": {
        "id": "TA0006",
        "name": "Credential Access",
        "reference": "https://attack.mitre.org/tactics/TA0006/"
      },
      "technique": [
        {
          "id": "T1040",
          "name": "Network Sniffing",
          "reference": "https://attack.mitre.org/techniques/T1040/"
        }
      ]
    },
    {
      "framework": "MITRE ATT&CK",
      "tactic": {
        "id": "TA0007",
        "name": "Discovery",
        "reference": "https://attack.mitre.org/tactics/TA0007/"
      },
      "technique": [
        {
          "id": "T1059.008",
          "name": "Command and Scripting Interpreter: Network Device CLI",
          "reference": "https://attack.mitre.org/techniques/T1059/008/"
        }
      ]
    },
    {
      "framework": "MITRE ATT&CK",
      "tactic": {
        "id": "TA0011",
        "name": "Command and Control",
        "reference": "https://attack.mitre.org/tactics/TA0011/"
      },
      "technique": [
        {
          "id": "T1571",
          "name": "Non-Standard Port",
          "reference": "https://attack.mitre.org/techniques/T1571/"
        }
      ]
    }
  ],
  "interval": "10m",
  "from": "now-10m",
  "max_signals": 100,
  "risk_score": 85,
  "output_index": ".alerts-security.alerts-default",
  "meta": {
    "false_positives": "Legitimate administrative activity on network devices may trigger command-line matches. High-port SSH (xxx22) may match legitimate services. Baseline normal activity and filter known good IPs."
  },
  "version": 1,
  "references": [
    "https://www.cisa.gov/news-events/cybersecurity-advisories/aa25-239a"
  ],
  "tags": [
    "Network Device",
    "CCP APT",
    "Persistence",
    "Defense Evasion",
    "Credential Access",
    "Discovery",
    "Command and Control"
  ],
  "actions": [],
  "throttle": "no_throttle",
  "custom_query_fields": [],
  "event_group": "host.name, user.name, reason"
}