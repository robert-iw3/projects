{
  "rule_id": "credential_brute_force_followed_by_success",
  "name": "Credential Brute Force Followed by Success",
  "description": "Detects credential brute force or credential stuffing attacks by monitoring for a high number of failed authentication attempts followed by a successful login for the same user within a 15-minute time window.",
  "severity": "critical",
  "enabled": true,
  "language": "esql",
  "query": "from * | where event.category == 'authentication' and event.type in ('authentication_success', 'authentication_failure') and user.name IS not NULL and user.name != '-' and user.name != 'unknown' | eval action = CASE(event.outcome == 'success', 'success', event.outcome == 'failure', 'failure', NULL) | stats failure_count = SUM(CASE(action == 'failure', 1, 0)), success_count = SUM(CASE(action == 'success', 1, 0)), src = ARRAY_AGG(source.ip), app = ARRAY_AGG(process.name) by user.name | where failure_count > 10 and success_count > 0 | keep user.name, failure_count, success_count, src, app",
  "type": "esql",
  "threat": [
    {
      "framework": "MITRE ATT&CK",
      "tactic": {
        "id": "TA0006",
        "name": "Credential Access",
        "reference": "https://attack.mitre.org/tactics/TA0006/"
      },
      "technique": [
        {
          "id": "T1110",
          "name": "Brute Force",
          "reference": "https://attack.mitre.org/techniques/T1110/"
        }
      ]
    }
  ],
  "interval": "15m",
  "from": "now-15m",
  "max_signals": 100,
  "risk_score": 95,
  "output_index": ".alerts-security.alerts-default",
  "meta": {},
  "version": 1,
  "references": [
    "https://detection.fyi/elastic/detection-rules/windows/credential_access_bruteforce_multiple_logon_failure_followed_by_success/",
    "https://www.elastic.co/blog/getting-started-elasticsearch-query-language"
  ],
  "tags": [
    "Authentication",
    "Brute Force",
    "Credential Stuffing"
  ],
  "actions": [],
  "throttle": "no_throttle",
  "custom_query_fields": [],
  "event_group": "user.name"
}
