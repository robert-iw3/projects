title: RoKRAT Malware Activity
id: e6cbc570-2255-4465-b56e-789394aed3e4
status: experimental
description: Detects various techniques, tactics, and procedures (TTPs) associated with the RoKRAT malware family. This includes the use of unusually large LNK files, PowerShell-based XOR decoding of file content, specific DLL side-loading patterns, and C2 communication from commonly injected processes.
references:
  - https://www.genians.co.kr/en/blog/threat_intelligence/rokrat_shellcode_steganographic
author: RW
date: 2025-08-06
tags:
  - attack.execution
  - attack.defense_evasion
  - attack.command_and_control
  - attack.t1059.001
  - attack.t1574.001
  - attack.t1027
  - attack.t1102
  - attack.t1055
  - apt.apt37
logsource:
  product: windows
  category:
    - process_creation
    - network_connection
    - image_load
    - file_creation
detection:
    # TTP: PowerShell XOR decoding of a file payload
  selection_psh:
    category: process_creation
    Image|endswith:
      - '\powershell.exe'
      - '\pwsh.exe'
    CommandLine|contains|all:
      - 'Get-Content'
      - '-bxor'
    # TTP: Unusually large LNK file, often containing embedded payloads
  selection_lnk:
    category: file_creation
    TargetFilename|endswith: '.lnk'
    FileSize|gt: 10000000     # Detects LNK files > 10MB; RoKRAT sample was ~54MB
    # TTP: C2 communication from processes commonly used for injection by RoKRAT
  selection_c2:
    category: network_connection
    Image|endswith:
      - '\mspaint.exe'
      - '\notepad.exe'
    DestinationHostname:
      - 'api.pcloud.com'
      - 'cloud-api.yandex.net'
      - 'api.dropboxapi.com'
    # TTP: Known DLL side-loading patterns used by RoKRAT
  selection_sideload_1:
    category: image_load
    Image|endswith: '\ShellRunas.exe'
    ImageLoaded|endswith: '\credui.dll'
  selection_sideload_2:
    category: image_load
    Image|endswith: '\AccessEnum.exe'
    ImageLoaded|endswith: '\mpr.dll'
  selection_sideload_3:
    category: image_load
    Image|endswith: '\Hhc.exe'
    ImageLoaded|endswith: '\hha.dll'
  condition: 1 of selection_*
falsepositives:
  - Legitimate administrative scripts might use PowerShell with XOR operations, although the combination with `Get-Content` is suspicious and warrants investigation.
  - Very large LNK files are highly unusual but could theoretically be created for legitimate, albeit strange, purposes.
  - The DLL side-loading patterns are specific, but it's possible for other software to use the same naming conventions. If alerted, investigate the file paths and hashes of the involved files.
level: high
