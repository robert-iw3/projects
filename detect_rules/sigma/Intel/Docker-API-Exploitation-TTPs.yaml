title: Multi-Stage Docker API Exploitation Campaign
id: c756764a-61b9-42cb-abcc-1ae695150397
status: experimental
description: >-
  Detects various techniques used in a multi-stage attack campaign targeting exposed Docker APIs.
  The attack involves initial access, installation of tools, persistence, discovery, and C2 activity.
  While this rule detects individual components, these indicators are of highest fidelity when observed together on the same host in a short time frame.
author: RW
date: 2025-09-09
tags:
  - attack.initial_access
  - attack.execution
  - attack.persistence
  - attack.defense_evasion
  - attack.discovery
  - attack.command_and_control
  - attack.t1190
  - attack.t1059.004
  - attack.t1098
  - attack.t1053.003
  - attack.t1562.004
  - attack.t1046
  - attack.t1090.003
logsource:
  product: linux
  category:
    - network_connection
    - process_creation
    - file_modification
    - dns_query
detection:
  # Tactic: Initial Access - Inbound connection to exposed Docker API port
  initial_access:
    category: network_connection
    destination.port: 2375
  # Tactic: Execution - Installation of malicious tools
  tools_install:
    category: process_creation
    Image|endswith:
      - '/apk'
      - '/apt'
      - '/yum'
    CommandLine|contains:
      - 'curl'
      - 'wget'
      - 'tor'
      - 'masscan'
      - 'torsocks'
      - 'zstd'
      - 'libpcap'
  # Tactic: Persistence - Modification of SSH authorized_keys
  persistence_ssh:
    category: file_modification
    TargetFilename|endswith: '/.ssh/authorized_keys'
  # Tactic: Persistence - Modification of cron files
  persistence_cron:
    category: file_modification
    TargetFilename|startswith:
      - '/etc/cron'
      - '/var/spool/cron'
  # Tactic: Defense Evasion - Firewall modification
  defense_evasion_fw:
    category: process_creation
    Image|endswith:
      - '/firewall-cmd'
      - '/iptables'
    CommandLine|contains:
      - '--add-rich-rule'
      - '--reload'
      - '-A INPUT'
  # Tactic: Discovery - Execution of masscan
  discovery_scan:
    category: process_creation
    Image|endswith: '/masscan'
  # Tactic: Discovery - Connections to other sensitive ports
  discovery_net:
    category: network_connection
    destination.port:
      - 23    # Telnet
      - 9222  # Chrome Debugging Port
  # Tactic: Command and Control - DNS query for .onion domain
  c2_dns:
    category: dns_query
    DnsQueryName|endswith: '.onion'
  # Tactic: Command and Control - Execution of Tor-related tools
  c2_proc:
    category: process_creation
    Image|endswith:
      - '/torsocks'
      - '/tor'
  condition: 1 of them
falsepositives:
  - Legitimate administrative activity involving package installation (curl, wget), firewall configuration, or use of Tor.
  - Network connections to port 2375 may be legitimate Docker API traffic, especially in development or management environments.
  - Vulnerability scanning may trigger network-related events. Correlation with other events is recommended to reduce false positives.
level: high
