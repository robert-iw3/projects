title: Unauthorized ICS Protocol Commands
status: experimental
description: >-
  Detects the execution of potentially malicious or unauthorized commands over common Industrial Control System (ICS) protocols.
  Such commands can be used by ICS-specific malware (like Industroyer, Triton, or BlackEnergy) or by an attacker to directly manipulate physical processes, stop controllers, or download malicious logic to devices.
  This rule focuses on network-based TTPs. A complementary rule for endpoint artifacts (e.g., malware file creation) is recommended for comprehensive coverage.
  This detection requires network monitoring solutions with deep packet inspection (DPI) capabilities for OT protocols (e.g., Zeek, Nozomi, Dragos, Claroty).
references:
  - https://www.cisa.gov/news-events/ics-advisories/icsa-18-204-01 # Triton
  - https://www.cisa.gov/news-events/ics-alerts/ics-alert-17-206-01 # Industroyer/CrashOverride
author: RW
date: 2025-08-18
tags:
  - attack.impair_process_control
  - attack.inhibit_response_function
  - attack.t0861
  - attack.t0843
  - ics.malware
logsource:
  category: ids
  # This rule is a template. The service, field names (e.g., protocol, command, function_code), and values are placeholders
  # and MUST be adapted to the specific OT IDS/network monitoring tool logs in your environment.
detection:
  # comment: Detects S7 'STOP CPU' command, used by malware like Industroyer to halt PLCs.
  s7_stop:
    protocol: 's7comm'
    command: 'CPU Functions'
    sub_command: 'STOP' # Placeholder for the specific action

  # comment: Detects DNP3 'Cold Restart' command, which can cause a device to reboot, potentially clearing evidence or disrupting processes.
  dnp3_restart:
    protocol: 'dnp3'
    function_code: 13 # DNP3 Cold Restart function code

  # comment: Detects Triton malware activity targeting Schneider Electric Triconex safety controllers by looking for program modification commands.
  triton_activity:
    protocol: 'tristation' # Protocol used by Triconex controllers
    command|contains: # Placeholder for a command field
      - 'LoadProgram'
      - 'Execute'
      - 'Halt'

  # comment: Detects a program download to a PLC, a key part of T0843. This is often a legitimate action, so it must be correlated with the source of the command.
  program_download:
    protocol|endswith: # Can be s7comm, enip, etc.
      - 'comm'
      - 'ip'
    command|contains:
      - 'Download'
      - 'Write Program'
      - 'Program Load'

  # comment: This filter is critical for reducing false positives. Populate this list with your authorized engineering workstations, HMIs, and management server IPs/subnets.
  filter_authorized_source:
    source.ip:
      - '10.100.1.10' # Placeholder for an Engineering Workstation (EWS)
      - '192.168.50.0/24' # Placeholder for a management subnet

  condition: (s7_stop or dnp3_restart or triton_activity or program_download) and not filter_authorized_source
falsepositives:
  - Legitimate remote maintenance, programming, or troubleshooting activities performed by engineers from authorized systems that are not in the filter list.
  - Automated system management scripts that perform these actions.
  - Network scanning or discovery tools that may probe these functions, although they are less likely to issue these specific commands.
level: high
