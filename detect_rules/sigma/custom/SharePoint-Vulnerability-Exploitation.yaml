title: SharePoint Vulnerability Exploitation (ToolShell)
id: a34737d8-d43d-4129-8e6d-38f4e43fe7e6
status: experimental
description: Detects web traffic patterns associated with the exploitation of SharePoint vulnerabilities (CVE-2025-49704, CVE-2025-49706, CVE-2025-53770, CVE-2025-53771), collectively known as ToolShell.
references:
  - https://www.cisa.gov/news-events/analysis-reports/ar25-218a
author: RW
date: 2025-08-06
tags:
  - attack.t1190
  - attack.t1210
  - attack.t1068
  - cve.2025.49704
  - cve.2025.49706
  - cve.2025.53770
  - cve.2025.53771
logsource:
  category: webserver
  product: ''
detection:
  selection_recon:
        # Detects reconnaissance or exploitation against ToolPane.aspx, a known entry point.
    c-uri|contains|all:
      - '/_layouts/15/ToolPane.aspx'
      - 'DisplayMode=Edit'
  selection_webshell_path:
    c-uri|contains:
      - '/_layouts/'
      - '/layouts/'
  selection_webshell_name:
        # Detects interaction with known malicious webshell names in SharePoint directories.
    c-uri|contains:
      - 'spinstall'
      - 'info'
      - 'debug'
  selection_deserialization:
        # Detects potential deserialization attempts using ViewState in POST data.
    c-uri|contains: '/_layouts/15/ToolPane.aspx'
    cs-method: 'POST'
    http.request.body.bytes|contains: 'VIEWSTATE'
  selection_exfil:
        # Detects a custom header used to exfiltrate machine key settings.
    c-header|contains: 'X-TXT-NET'
  condition: selection_recon or (selection_webshell_path and selection_webshell_name) or selection_deserialization or selection_exfil
falsepositives:
  - Legitimate administrative activity may involve accessing ToolPane.aspx. Review the source IP and user agent for anomalous activity.
  - The 'VIEWSTATE' keyword is a standard component of ASP.NET and may generate false positives. This detection is more reliable when correlated with other indicators.
level: critical
