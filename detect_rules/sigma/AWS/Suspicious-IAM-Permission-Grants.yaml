title: AWS IAM Policy Created with Suspicious Permissions
id: a1154e22-5c87-4265-889e-de98aff29269
status: experimental
description: >-
  Detects the creation or modification of an IAM policy that grants permissions commonly associated with S3 ransomware attacks. Attackers may create new policies or roles with permissions to read, write, and delete S3 objects, and to use KMS keys for encryption, as a preparatory step for encrypting data for ransom.
references:
  - https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/
author: RW
date: 2025-08-19
tags:
  - attack.impact
  - attack.t1486
  - attack.persistence
  - attack.t1098
logsource:
  product: aws
  service: iam
detection:
  # Events that create or modify IAM policies
  selection_events:
    eventName:
      - 'CreatePolicy'
      - 'CreatePolicyVersion'
      - 'PutRolePolicy'
      - 'PutUserPolicy'
      - 'PutGroupPolicy'
  # Specific permissions used in S3 ransomware attacks
  selection_permissions:
    requestParameters.policyDocument|contains:
      - 's3:PutObject'
      - 's3:PutObjectAcl'
      - 's3:PutObjectVersionAcl'
      - 's3:DeleteObject'
      - 's3:DeleteObjectVersion'
      - 'kms:Encrypt'
      - 'kms:GenerateDataKey'
  # Overly permissive wildcards are a common indicator of malicious or misconfigured policies
  selection_wildcards:
    requestParameters.policyDocument|contains:
      - '"Action":"s3:*"'
      - '"Action":"kms:*"'
      - '"Resource":"*"'
      - '"Resource":"arn:aws:s3:::*"'
  # Condition: a policy is changed to include either specific risky permissions or broad wildcards
  condition: selection_events and (selection_permissions or selection_wildcards)
falsepositives:
  - Legitimate administrative activity creating or updating policies for users, roles, or applications that require these permissions.
  - Automated infrastructure-as-code tools (e.g., Terraform, CloudFormation) that manage IAM policies.
  - Consider filtering out events generated by known administrative users or service roles to reduce noise.
level: medium
