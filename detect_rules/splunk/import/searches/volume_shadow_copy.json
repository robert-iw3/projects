[
  {
    "name": "Volume Shadow Copy Deletion",
    "description": "Detects the deletion of Volume Shadow Copies using vssadmin.exe, wmic.exe, or PowerShell commands, which is a common tactic used by ransomware and attackers to prevent system recovery.",
    "search": "| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where ((Processes.process_name=\"vssadmin.exe\" AND Processes.process=\"*delete*\" AND Processes.process=\"*shadows*\") OR (Processes.process_name=\"wmic.exe\" AND Processes.process=\"*shadowcopy*\" AND Processes.process=\"*delete*\") OR (Processes.process_name IN (\"powershell.exe\", \"pwsh.exe\") AND Processes.process=\"*Win32_ShadowCopy*\" AND (Processes.process=\"*Delete*\" OR Processes.process=\"*Remove-CimInstance*\"))) by Processes.dest, Processes.user, Processes.parent_process_name, Processes.process_name, Processes.process | `drop_dm_object_name(\"Processes\")` | rename dest as host, user as executing_user, parent_process_name as parent_process, process_name as process, process as command_line | `ctime(firstTime)` | `ctime(lastTime)` | table firstTime, lastTime, host, executing_user, parent_process, process, command_line, count",
    "is_scheduled": 1,
    "disabled": 0,
    "cron_schedule": "*/30 * * * *",
    "dispatch.earliest_time": "-24h",
    "dispatch.latest_time": "now",
    "sharing": "global",
    "acl": {
      "read": ["power", "admin"],
      "write": ["admin"]
    }
  }
]
