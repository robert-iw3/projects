[
  {
    "name": "DPRK Fraudulent IT Worker Activity",
    "search": "| tstats `summariesonly` earliest(_time) as firstTime, latest(_time) as lastTime, dc(src_ip_country) as country_count, values(src_ip_country) as countries from datamodel=Authentication where nodename=All_Authentication by user, _time span=4h | `drop_dm_object_name(\"Authentication\")` | where country_count > 1 | eval detection_type=\"Impossible Travel - Multi-Geo Login\" | eval description=user.\" logged in from \".country_count.\" countries: \".mvjoin(countries,\", \"). \" within 4 hours.\" | table _time, user, countries, description, detection_type | append [ | tstats `summariesonly` count from datamodel=Web where Web.category IN (\"Phishing & Fraud\", \"Malware\") by _time, Web.user, Web.url, Web.dest | `drop_dm_object_name(\"Web\")` | rename Web.* as * | eval detection_type=\"Phishing Link Click\" | eval description=user.\" accessed a URL categorized as phishing/malware: \".url | table _time, user, url, dest, description, detection_type ] | append [ search `proxy` OR `dns` | rex field=url \"https?:\\/\\/(?:[^\\/]+\\.)?(?<domain>[^\\/]+\\.(?:xyz|top|online|club|live|icu|gq|buzz))\" | where isnotnull(domain) | stats count by _time, user, src, dest, url, domain | eval detection_type=\"Suspicious TLD Visited\" | eval description=user.\" visited a URL with a suspicious TLD: \".url | table _time, user, src, dest, url, description, detection_type ] | append [ | tstats `summariesonly` count from datamodel=Endpoint.Processes where (Processes.process_name IN (\"powershell.exe\", \"pwsh.exe\") AND Processes.process IN (\"* -enc *\", \"* -encoded *\", \"* -w hidden *\", \"* IEX *\", \"* Invoke-Expression *\")) OR (Processes.process_name=\"mshta.exe\" AND Processes.process IN (\"*http:*\", \"*https:*\", \"*javascript:*\")) by _time, Processes.user, Processes.dest, Processes.process_name, Processes.process | `drop_dm_object_name(\"Processes\")` | rename Processes.* as * | eval detection_type=\"Suspicious Process Execution\" | eval description=user.\" executed a suspicious command on \".dest.\": \".process | table _time, user, dest, process_name, process, description, detection_type ] | append [ search `wineventlog` EventCode=4697 source=\"Microsoft-Windows-Security-Auditing\" | rename \"Service Name\" as service_name, \"Service File Name\" as service_path | stats values(service_path) as service_path by _time, user, dest, service_name | eval detection_type=\"New Service Created\" | eval description=\"A new service '\".service_name.\"' pointing to '\".service_path.\"' was created on \".dest.\" by \".user | table _time, user, dest, service_name, service_path, description, detection_type ] | append [ search `wineventlog` source=\"Microsoft-Windows-TaskScheduler/Operational\" EventCode=106 | rex \"Task Scheduler registered task \\\"(?<task_name>[^\\\"]+)\\\"\" | stats count by _time, user, dest, task_name | eval detection_type=\"New Scheduled Task Created\" | eval description=\"A new scheduled task '\".task_name.\"' was created on \".dest.\" by \".user | table _time, user, dest, task_name, description, detection_type ] | append [ search `proxy` | `get_risk_object` | search (url=\"*binance.com*\" OR url=\"*coinbase.com*\" OR url=\"*kraken.com*\" OR url=\"*kucoin.com*\" OR url=\"*bybit.com*\" OR url=\"*metamask.io*\") | stats count by _time, user, src, dest, url | eval detection_type=\"Cryptocurrency Site Visited\" | eval description=user.\" accessed a cryptocurrency-related website: \".url | table _time, user, src, dest, url, description, detection_type ]",
    "description": "Combines several detection rules to identify multi-geo impossible travel, phishing link clicks, suspicious TLDs, process execution, new services/tasks, and cryptocurrency web activity.",
    "is_scheduled": 1,
    "disabled": 0,
    "cron_schedule": "*/30 * * * *",
    "dispatch.earliest_time": "-24h",
    "dispatch.latest_time": "now",
    "sharing": "global",
    "acl": {
      "read": ["power", "admin"],
      "write": ["admin"]
    }
  }
]
