[
  {
    "name": "Proxy Bypass Detection",
    "description": "Detects network connections that occur on common web ports (80, 443) but do not have a corresponding event in the Web datamodel, which may indicate that a process has bypassed the system proxy.",
    "search": "| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Network_Traffic where All_Traffic.action=allowed (All_Traffic.dest_port=80 OR All_Traffic.dest_port=443) by All_Traffic.src, All_Traffic.dest, All_Traffic.dest_port | `drop_dm_object_name(\"All_Traffic\")` | join type=left src, dest, dest_port [ | tstats `summariesonly` count from datamodel=Web by Web.src, Web.dest, Web.dest_port | `drop_dm_object_name(\"Web\")` | rename count as proxy_event_count ] | where isnull(proxy_event_count) | where NOT (cidrmatch(\"10.0.0.0/8\", dest) OR cidrmatch(\"172.16.0.0/12\", dest) OR cidrmatch(\"192.168.0.0/16\", dest) OR cidrmatch(\"224.0.0.0/4\", dest)) | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | table firstTime, lastTime, src, dest, dest_port, count",
    "is_scheduled": 1,
    "disabled": 0,
    "cron_schedule": "*/30 * * * *",
    "dispatch.earliest_time": "-24h",
    "dispatch.latest_time": "now",
    "sharing": "global",
    "acl": {
      "read": ["power", "admin"],
      "write": ["admin"]
    }
  }
]
