[
    {
        "name": "WaterCurse_Indicator_1",
        "description": "Initial Execution via MSBuild.",
        "search": "| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where (Processes.parent_process_name=\"MSBuild.exe\" AND Processes.process_name=\"cmd.exe\" AND Processes.process=\"*/c*\" AND Processes.process=\"*.exec.cmd*\" AND Processes.process=\"*Temp\\\\MSBuildTemp*\") by Processes.dest Processes.user Processes.parent_process_name Processes.process_name Processes.process\n| `drop_dm_object_name(\"Processes\")`\n| `security_content_ctime(firstTime)`\n| `security_content_ctime(lastTime)`\n| eval Tactic=\"Execution\", Technique=\"T1129\", Activity=\"WaterCurse: Initial Execution via MSBuild\"",
        "is_scheduled": 1,
        "disabled": 0,
        "cron_schedule": "*/30 * * * *",
        "dispatch.earliest_time": "-24h",
        "dispatch.latest_time": "now",
        "sharing": "global",
        "acl": {
        "read": ["power", "admin"],
        "write": ["admin"]
        }
    },
    {
        "name": "WaterCurse_Indicator_2",
        "description": "Defense Evasion via PowerShell to disable Windows Defender and System Restore.",
        "search": "| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=\"powershell.exe\" AND (Processes.process=\"*Set-MpPreference* -ExclusionPath*C:\\\\*\" OR Processes.process=\"*vssadmin*delete*shadows*/all*\" OR Processes.process=\"*Set-ItemProperty*HKLM:\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows NT\\\\SystemRestore*DisableSR*\") by Processes.dest Processes.user Processes.process_name Processes.process\n| `drop_dm_object_name(\"Processes\")`\n| `security_content_ctime(firstTime)`\n| `security_content_ctime(lastTime)`\n| eval Tactic=\"Defense Evasion\", Technique=\"T1562.001\", Activity=\"WaterCurse: Defense Evasion via PowerShell\"",
        "is_scheduled": 1,
        "disabled": 0,
        "cron_schedule": "*/30 * * * *",
        "dispatch.earliest_time": "-24h",
        "dispatch.latest_time": "now",
        "sharing": "global",
        "acl": {
        "read": ["power", "admin"],
        "write": ["admin"]
        }
    },
    {
        "name": "WaterCurse_Indicator_3",
        "description": "UAC Bypass via ms-settings protocol handler hijack.",
        "search": "| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Registry where Registry.registry_path=\"*\\\\Software\\\\Classes\\\\ms-settings\\\\shell\\\\open\\\\command*\" AND (Registry.registry_value_name=\"(Default)\" OR Registry.registry_value_name=\"DelegateExecute\") by Registry.dest Registry.user Registry.registry_path Registry.registry_value_name\n| `drop_dm_object_name(\"Registry\")`\n| `security_content_ctime(firstTime)`\n| `security_content_ctime(lastTime)`\n| eval Tactic=\"Privilege Escalation\", Technique=\"T1548.002\", Activity=\"WaterCurse: UAC Bypass via ms-settings Hijack\"",
        "is_scheduled": 1,
        "disabled": 0,
        "cron_schedule": "*/30 * * * *",
        "dispatch.earliest_time": "-24h",
        "dispatch.latest_time": "now",
        "sharing": "global",
        "acl": {
        "read": ["power", "admin"],
        "write": ["admin"]
        }
    },
    {
        "name": "WaterCurse_Indicator_4",
        "description": "Persistence via unusually configured Scheduled Task.",
        "search": "| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where Processes.process_name=\"schtasks.exe\" AND Processes.process=\"*/create*\" AND (Processes.process=\"*/du 9999:59*\" OR (Processes.process=\"*BitLocker Encrypt All Drives*\" AND Processes.process=\"*\\\\OneDriveCloud\\\\taskhostw.exe*\")) by Processes.dest Processes.user Processes.process_name Processes.process\n| `drop_dm_object_name(\"Processes\")`\n| `security_content_ctime(firstTime)`\n| `security_content_ctime(lastTime)`\n| eval Tactic=\"Persistence\", Technique=\"T1053.005\", Activity=\"WaterCurse: Persistence via Scheduled Task\"",
        "is_scheduled": 1,
        "disabled": 0,
        "cron_schedule": "*/30 * * * *",
        "dispatch.earliest_time": "-24h",
        "dispatch.latest_time": "now",
        "sharing": "global",
        "acl": {
        "read": ["power", "admin"],
        "write": ["admin"]
        }
    },
    {
        "name": "WaterCurse_Indicator_5",
        "description": "Data Staging and Reconnaissance.",
        "search": "| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Processes where ((Processes.process_name=\"7z.exe\" AND Processes.process_path=\"C:\\\\ProgramData\\\\sevenZip\\\\*\" AND Processes.process=\"*-p*\") OR (Processes.parent_process_name=\"NVIDIA Control Panel.exe\" AND Processes.parent_process_path=\"*\\\\Microsoft\\\\Vault\\\\UserRoamingTiles\\\\NVIDIAContainer*\" AND Processes.process_name IN (\"curl.exe\", \"wmic.exe\", \"tasklist.exe\"))) by Processes.dest Processes.user Processes.parent_process_name Processes.parent_process_path Processes.process_name Processes.process_path Processes.process\n| `drop_dm_object_name(\"Processes\")`\n| `security_content_ctime(firstTime)`\n| `security_content_ctime(lastTime)`\n| eval Tactic=\"Collection\", Technique=\"T1560\", Activity=\"WaterCurse: Staging and Reconnaissance\"",
        "is_scheduled": 1,
        "disabled": 0,
        "cron_schedule": "*/30 * * * *",
        "dispatch.earliest_time": "-24h",
        "dispatch.latest_time": "now",
        "sharing": "global",
        "acl": {
        "read": ["power", "admin"],
        "write": ["admin"]
        }
    },
    {
        "name": "WaterCurse_Indicator_6",
        "description": "Malicious File Artifacts Creation.",
        "search": "| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Filesystem where ((Filesystem.file_path=\"*\\\\.vs-script\\\\*\" AND Filesystem.file_name IN (\"antiDebug.ps1\", \"disabledefender.ps1\")) OR (Filesystem.file_path=\"*\\\\AppData\\\\Local\\\\Temp\\\\*\" AND Filesystem.file_name=\"SearchFilter.exe\") OR (Filesystem.file_path=\"*\\\\Microsoft\\\\Vault\\\\UserRoamingTiles\\\\NVIDIAContainer*\" AND Filesystem.file_name=\"NVIDIA Control Panel.exe\")) by Filesystem.dest Filesystem.user Filesystem.file_path Filesystem.file_name\n| `drop_dm_object_name(\"Filesystem\")`\n| `security_content_ctime(firstTime)`\n| `security_content_ctime(lastTime)`\n| eval Tactic=\"Initial Access\", Technique=\"T1195.002\", Activity=\"WaterCurse: Malicious File Artifact Creation\"",
        "is_scheduled": 1,
        "disabled": 0,
        "cron_schedule": "*/30 * * * *",
        "dispatch.earliest_time": "-24h",
        "dispatch.latest_time": "now",
        "sharing": "global",
        "acl": {
        "read": ["power", "admin"],
        "write": ["admin"]
        }
    },
    {
        "name": "WaterCurse_Indicator_7",
        "description": "C2 and Exfiltration Network Activity.",
        "search": "| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Endpoint.Network_Traffic where (Network_Traffic.url IN (\"*store-eu-par-2.gofile.io*\", \"*api.telegram.org*\", \"*popcorn-soft.glitch.me*\", \"*pastejustit.com*\", \"*pastesio.com*\") OR Network_Traffic.dest_ip=\"46.101.236.176\" OR Network_Traffic.process_name=\"RegAsm.exe\") by Network_Traffic.dest Network_Traffic.user Network_Traffic.process_name Network_Traffic.url Network_Traffic.dest_ip\n| `drop_dm_object_name(\"Network_Traffic\")`\n| `security_content_ctime(firstTime)`\n| `security_content_ctime(lastTime)`\n| eval process_name=if(process_name==\"RegAsm.exe\", \"RegAsm.exe (Suspicious C2)\", process_name)\n| eval Tactic=\"Command and Control\", Technique=\"T1071\", Activity=\"WaterCurse: C2/Exfiltration Network Connection\"",
        "is_scheduled": 1,
        "disabled": 0,
        "cron_schedule": "*/30 * * * *",
        "dispatch.earliest_time": "-24h",
        "dispatch.latest_time": "now",
        "sharing": "global",
        "acl": {
        "read": ["power", "admin"],
        "write": ["admin"]
        }
    }
]
