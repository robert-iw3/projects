### Common Industrial Protocol (CIP) Exploits and Detections
---

This report summarizes the Common Industrial Protocol (CIP) and associated vulnerabilities, focusing on how these can be exploited in Industrial Control Systems (ICS) environments. It highlights the importance of understanding CIP's role in ICS and the potential for significant impacts from successful exploits, including risks to human safety, the environment, and physical infrastructure.

Recent intelligence indicates a continued rise in cyberattacks targeting ICS, with a significant increase in adversarial reconnaissance against industrial protocols like Modbus/TCP. Furthermore, new Critical Infrastructure Protection (CIP) standards are being introduced in 2024 and 2025, emphasizing enhanced visibility and real-time contextual awareness for proactive defense against evolving threats.

### Actionable Threat Data
---

Monitor for anomalous CIP traffic patterns: Implement anomaly detection techniques to identify deviations from normal CIP communication behavior, such as unusual service requests, unexpected class/instance/attribute access, or abnormal data sizes. This can help detect fuzzing attempts or other malicious interactions with CIP devices.

Detect malformed CIP packets: Look for CIP packets that do not conform to the protocol specification, especially those with unusual lengths, invalid object paths, or unexpected data in fields. Such malformed packets can indicate attempts to trigger denial-of-service conditions or memory corruption vulnerabilities.

Identify unauthorized CIP service requests: Establish a baseline of expected CIP service requests for each device and alert on any requests that fall outside this baseline. This includes monitoring for "Get All Attributes" (0x01) or "Get Attribute List" (0x03) services from unexpected sources, which could indicate reconnaissance or fuzzing activities.

Monitor for CIP communication with internet-facing ICS devices: Actively monitor and alert on any CIP communication originating from or destined for internet-facing ICS devices, as this significantly increases the attack surface and is a common vector for exploitation.

Track changes to CIP device configurations: Implement monitoring for unauthorized changes to CIP device configurations, including firmware updates or modifications to operational parameters, which could indicate a compromise.

### Search
---
```sql
-- Name: CIP Class Fuzzing Attempt
-- Author: RW
-- Date: 2025-08-17
--
-- Description: Detects a potential Common Industrial Protocol (CIP) class fuzzing attempt. This technique, as described in the provided intelligence, involves sending 'Get Attribute List' (0x03) requests to the static class instance (0x00) for a wide range of class IDs to discover supported classes on a target device. This is a form of anomalous traffic indicative of reconnaissance.
--
-- References:
-- - https://github.com/ICSVillage
--
-- False Positive Sensitivity: Medium
--
-- Tags: ICS, CIP, EtherNet/IP, Reconnaissance, Fuzzing, Anomalous Traffic
--
-- Rule:
-- This rule requires CIP/Ethernet/IP traffic logs, typically from an OT security monitoring tool (e.g., Zeek, Claroty, Dragos, Nozomi).
-- The data should be parsed with fields for CIP protocol attributes.
-- Replace `cip_traffic` with a macro or search for your specific data source.
--
`cip_traffic`
-- The fuzzing technique uses the 'Get Attribute List' service (0x03) on the static class instance (0x00).
-- Field values may be integer or hex strings depending on the parser.
| where cip_service IN ("3", "0x03") AND cip_instance IN ("0", "0x00")
| bucket _time span=15m
-- Group by source IP and count the number of distinct classes being probed.
| stats dc(cip_class) as fuzzed_class_count, dc(dest) as targeted_device_count, values(cip_class) as sample_fuzzed_classes, values(dest) as sample_targeted_devices by src, _time
-- The threshold defines how many unique classes must be scanned to trigger an alert.
-- Adjust this threshold based on your environment's baseline.
| where fuzzed_class_count > 20
-- Formatting the output for an alert.
| eval start_time=strftime(_time, "%Y-%m-%d %H:%M:%S"), end_time=strftime(_time + 900, "%Y-%m-%d %H:%M:%S")
| project
  start_time,
  end_time,
  src,
  fuzzed_class_count,
  targeted_device_count,
  sample_fuzzed_classes,
  sample_targeted_devices
-- Potential False Positives:
-- Legitimate engineering workstations or asset inventory software might perform class discovery.
-- This activity is typically infrequent and targets a smaller, known set of classes.
-- Consider allow-listing known engineering/management IP addresses if they generate false positives.
```
---
```sql
-- Name: Malformed CIP Packet Detection
-- Author: RW
-- Date: 2025-08-17
-- Description: Detects malformed Common Industrial Protocol (CIP) packets based on alerts from an OT security monitoring tool. These can indicate attempts to trigger denial-of-service, cause memory corruption, or exploit vulnerabilities in the target device's protocol stack.
-- False Positive Sensitivity: Medium
-- Tags: ICS, CIP, EtherNet/IP, Denial of Service, Exploitation

-- This rule requires alerts from an OT security monitoring tool (e.g., Zeek, Nozomi, Dragos, Claroty).
-- Replace `ot_security_alerts` with the appropriate macro or index/sourcetype for your environment.
`ot_security_alerts`
-- Filter for alerts indicating malformed or non-compliant CIP/EtherNet/IP packets.
-- The alert_name values are examples; adjust them to match your monitoring tool's output.
| where (match(alert_name, "(?i)malformed|violation|illegal") AND protocol IN ("CIP", "EtherNet/IP"))
    OR alert_name IN (
        "Invalid CIP Packet Length",
        "Invalid CIP Service",
        "CIP Protocol Anomaly",
        "Disallowed Function in CIP"
    )
-- Summarize alerts to identify targeted attacks and reduce noise from single, potentially benign events.
| stats count, earliest(_time) as first_seen, latest(_time) as last_seen, values(alert_name) as distinct_alert_names by src_ip, dest_ip, dest_device_name
-- Potential False Positives:
-- - A device using a non-standard or proprietary extension of the CIP protocol might be flagged as malformed.
-- - Network issues or misconfigurations could potentially corrupt packets.
-- - Investigation should focus on the specific violation reported and the source of the traffic. Consider allow-listing specific source/destination pairs if they are known to have benign, non-standard communication.
| rename src_ip as SourceIp, dest_ip as DestinationIp, dest_device_name as DestinationDevice
| convert ctime(first_seen) ctime(last_seen)
| fields first_seen, last_seen, SourceIp, DestinationIp, DestinationDevice, count, distinct_alert_names
```
---
```sql
-- Name: Unauthorized CIP Service Requests
-- Author: RW
-- Date: 2025-08-17
--
-- Description: Detects reconnaissance and fuzzing activity targeting Industrial Control Systems (ICS). The rule identifies Common Industrial Protocol (CIP) "Get All Attributes" (0x01) and "Get Attribute List" (0x03) service requests originating from sources not on an allowlist of known management or engineering hosts.
--
-- References:
-- - https://github.com/ICSVillage
--
-- False Positive Sensitivity: Medium
--
-- Tags: ICS, CIP, EtherNet/IP, Reconnaissance, TTPs
--
-- Rule:
-- This rule requires CIP/Ethernet/IP traffic logs, typically from an OT security monitoring tool (e.g., Zeek, Claroty, Dragos, Nozomi).
-- The data should be parsed with fields for CIP protocol attributes.
-- Replace `cip_traffic` with a macro or search for your specific data source.
--
`cip_traffic`
-- Filter for the specific CIP services used for reconnaissance.
-- Service codes can be represented as hex or integer depending on the data source.
| where cip_service IN ("1", "0x01", "3", "0x03")
-- Exclude traffic from known, authorized hosts to focus on unexpected activity.
-- This lookup is critical for reducing false positives. Populate `known_management_hosts.csv` with a single column 'ip' containing the IP addresses of legitimate engineering workstations, HMIs, or asset management systems.
| search NOT [| inputlookup append=T known_management_hosts.csv | rename ip as src]
-- Summarize the activity to provide a concise alert.
| stats
  count as request_count,
  earliest(_time) as start_time,
  latest(_time) as end_time,
  values(dest) as targeted_devices,
  values(cip_service) as services_used
  by src
-- Formatting the output for an alert.
| convert ctime(start_time), ctime(end_time)
| rename
  src as SourceIp,
  request_count as RequestCount,
  targeted_devices as TargetedDevices,
  services_used as ServicesUsed
-- Potential False Positives:
-- - A new, unlisted engineering workstation or a temporary contractor machine performing legitimate work.
-- - Misconfigured asset inventory tools.
-- - Regular maintenance and tuning of the 'known_management_hosts.csv' allowlist is essential for accuracy.
| table
  start_time,
  end_time,
  SourceIp,
  RequestCount,
  TargetedDevices,
  ServicesUsed
```
---
```sql
-- Name: CIP Communication with Internet-Facing Device
-- Author: RW
-- Date: 2025-08-17
--
-- Description: Detects Common Industrial Protocol (CIP) traffic between an internal, private IP address (assumed ICS device) and a public, internet-routable IP address. Exposing ICS devices and protocols directly to the internet is a significant security risk and a common vector for exploitation.
--
-- False Positive Sensitivity: Medium
--
-- Tags: ICS, CIP, EtherNet/IP, TTPs, Initial Access, Internet-Exposed
--
-- Rule:
-- This rule is optimized for the Splunk Common Information Model (CIM) and the Network_Traffic data model.
-- If you do not use the CIM, replace the `tstats` command with a search against your raw network logs and rename fields as needed (e.g., src_ip to src, dest_ip to dest).
--
| tstats `summariesonly` count from datamodel=Network_Traffic where (All_Traffic.dest_port=44818 OR All_Traffic.src_port=44818) by _time, All_Traffic.src, All_Traffic.dest, All_Traffic.dest_port, All_Traffic.src_device_name
| rename "All_Traffic.*" as *
-- Identify if source and destination IPs are in private address space (RFC1918).
| eval src_is_private = if(cidrmatch("10.0.0.0/8", src) OR cidrmatch("172.16.0.0/12", src) OR cidrmatch("192.168.0.0/16", src), 1, 0)
| eval dest_is_private = if(cidrmatch("10.0.0.0/8", dest) OR cidrmatch("172.16.0.0/12", dest) OR cidrmatch("192.168.0.0/16", dest), 1, 0)
-- Filter for traffic between a private and a public IP.
| where src_is_private != dest_is_private
-- Assign IPs to clear roles for readability.
| eval IcsDeviceIp = if(src_is_private=1, src, dest)
| eval PublicIp = if(src_is_private=0, src, dest)
-- Exclude traffic to/from authorized public IPs to reduce noise.
-- This lookup is critical. Populate `authorized_public_ips_for_ics.csv` with a single column 'public_ip' containing IPs of legitimate vendor support, cloud services, etc.
| search NOT [| inputlookup append=T authorized_public_ips_for_ics.csv | rename public_ip as PublicIp | fields PublicIp]
-- Define the connection direction based on the destination port.
| eval ConnectionDirection = if(dest_port=44818, "Inbound to ICS", "Outbound from ICS")
-- Summarize the events to create a single alert per unique connection.
| stats sum(count) as EventCount, earliest(_time) as StartTime, latest(_time) as EndTime, values(src_device_name) as ReportedDeviceName by IcsDeviceIp, PublicIp, ConnectionDirection
-- Format the output for the alert.
| convert ctime(StartTime) ctime(EndTime)
| fields StartTime, EndTime, IcsDeviceIp, PublicIp, ConnectionDirection, EventCount, ReportedDeviceName
-- Potential False Positives:
-- - Legitimate but unlisted remote access or cloud integration services.
-- - Misconfigurations in network address translation (NAT) or logging that obscure the true source/destination.
-- - Regular maintenance of the 'authorized_public_ips_for_ics.csv' allowlist is essential for accuracy.
```
---
```sql
-- Name: Unauthorized CIP Device Configuration Change
-- Author: RW
-- Date: 2025-08-17
--
-- Description: Detects alerts related to Common Industrial Protocol (CIP) device configuration changes originating from a source IP not on the authorized list. Such changes can include firmware updates, PLC program downloads, or operational mode changes (e.g., RUN to STOP), and may indicate a compromise or unauthorized activity within the ICS environment.
--
-- False Positive Sensitivity: Medium
--
-- Tags: ICS, CIP, EtherNet/IP, Persistence, Impact, TTPs
--
-- Rule:
-- This rule is optimized for alerts from an OT security monitoring tool (e.g., Defender for IoT, Nozomi, Dragos).
-- Replace `ot_security_alerts` with the appropriate macro or index/sourcetype for your environment. Run over the last 1 hour.
--
`ot_security_alerts`
-- Filter for alerts that indicate a configuration or operational state change on an ICS device.
-- These alert names are examples; they must be tuned to match the specific alerts generated by your security tool.
| where alert_name IN (
    "Configuration Change",
    "Firmware Update",
    "Program Download",
    "PLC Mode Change",
    "PLC Stop Command Detected",
    "Unauthorized PLC Programming"
  )
-- An unauthorized source is one NOT in our allowlist. This is the core logic for detecting "unauthorized" activity.
-- Create a lookup file named `authorized_change_sources.csv` with a single column 'ip' containing the IP addresses of authorized engineering workstations.
| search NOT [| inputlookup append=T authorized_change_sources.csv | rename ip as src]
-- Summarize the activity to create a concise alert for investigation.
| stats
    earliest(_time) as start_time,
    latest(_time) as end_time,
    count as alert_count,
    values(alert_name) as distinct_alerts,
    values(dest_device) as targeted_devices
    by src, protocol
-- Format the output for the alert.
| convert ctime(start_time), ctime(end_time)
| rename
    src as SourceIp,
    protocol as Protocol,
    alert_count as AlertCount,
    distinct_alerts as DistinctAlerts,
    targeted_devices as TargetedDevices
-- Potential False Positives:
-- - A new or temporary engineering workstation was used for legitimate changes but not added to the 'authorized_change_sources.csv' allowlist.
-- - An authorized host had its IP address changed.
-- - Regular maintenance and tuning of the allowlist is essential for accuracy.
| table
    start_time,
    end_time,
    SourceIp,
    TargetedDevices,
    Protocol,
    AlertCount,
    DistinctAlerts
```