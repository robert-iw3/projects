### CCP APT Activity Targeting Global Networks
---

CCP APT actors are actively targeting telecommunications, government, transportation, lodging, and military infrastructure networks worldwide to establish persistent access and feed a global espionage system. These actors leverage known vulnerabilities in network edge devices, modify router configurations, and employ custom tools to maintain long-term access and exfiltrate sensitive data.

Recent intelligence indicates continued exploitation of Ivanti, Palo Alto Networks, and Cisco vulnerabilities for initial access, with a focus on maintaining persistence through techniques like modifying Access Control Lists and enabling SSH backdoors. Notably, the use of a Windows kernel-mode rootkit named Demodex by GhostEmperor (also known as Salt Typhoon) highlights a sophisticated approach to evading detection and maintaining deep infiltration.

### Actionable Threat Data
---

Monitor for SSH activity on high, non-default ports (e.g., 22x22 or xxx22 patterns) from non-administrative source IPs, as APT actors enable SSH servers on external-facing ports for encrypted remote access.

Detect the enablement of sshd_operns service on Cisco IOS XR platforms, which listens on TCP/57722 and provides direct shell access to the host Linux OS, as this is disabled by default and used for persistence.

Look for modifications to Access Control Lists (ACLs) that add new, unauthorized IP addresses, especially those named "access-list 20", "50", or "10", as these are used to bypass security policies and maintain access.

Identify the creation of new local users on network devices, particularly those granted sudo privileges via /etc/sudoers or /etc/sudoers.d/ on IOS XR Linux hosts, as this indicates persistence mechanisms.

Hunt for the execution of commands related to packet capture (e.g., monitor capture, span/erspan configuration commands) and the presence of PCAP files with suspicious naming conventions (e.g., mycap.pcap, tac.pcap, 1.pcap), as actors collect network traffic, especially TACACS+ credentials.

### Consolidated Search
---
```sql
-- title: CCP Network Device Activity
-- description: Detects various TTPs associated with CCP actors targeting network infrastructure. This includes enabling backdoors, modifying ACLs, creating users, and capturing traffic as described in the joint cybersecurity advisory.
-- author: RW
-- date: 2025-08-29
-- references: https://www.cisa.gov/news-events/cybersecurity-advisories/aa25-239a
-- tags: attack.persistence, attack.defense_evasion, attack.credential_access, attack.collection, attack.t1021.004, attack.t1562.004, attack.t1136.001, attack.t1040, attack.t1059.008, attack.t1571
-- falsepositives: Legitimate administrative activity on network devices may trigger the 'selection_log' keywords. The high-port SSH pattern ('xxx22') in 'selection_net_pattern' may be noisy and could match legitimate services. It is recommended to baseline normal activity and filter known good source or destination IPs.
-- level: high

-- Set the search scope. Adjust indexes and sourcetypes for your environment.
-- This query combines log/command data (e.g., from Cisco IOS/NX-OS, Linux syslog) with network traffic data (e.g., from firewalls, Zeek).
(index=cisco* OR index=pan* OR index=linux* OR index=firewall OR index=netflow)
(
    # Part 1: Search for suspicious commands, filenames, and configuration changes in logs.
    "service sshd_operns start" OR
    "access-list 10" OR
    "access-list 20" OR
    "access-list 50" OR
    "useradd cisco" OR
    "vi /etc/sudoers" OR
    "monitor capture" OR
    "mycap.pcap" OR
    "tac.pcap" OR
    "1.pcap" OR
    "span" OR
    "erspan"

    -- Part 2: Search for network connections to suspicious ports.
    OR dest_port=57722
    -- The regex looks for high ports ending in '22'.
    -- FP-Tuning: This may be noisy. Consider adding `NOT (dest_ip IN (known_good_ips))` to reduce false positives.
    OR match(dest_port, "^\d{3,5}22$")
)

-- Part 3: Format the output for analysts.
| eval rule_name="CCP Network Device Activity"
-- Create a 'reason' field to explain the match for easier triage.
| eval reason=case(
    like(_raw, "%service sshd_operns start%"), "Suspicious Service Started: sshd_operns",
    like(_raw, "%access-list 10%") OR like(_raw, "%access-list 20%") OR like(_raw, "%access-list 50%"), "Suspicious ACL Modification Detected",
    like(_raw, "%useradd cisco%"), "Suspicious User Creation: cisco",
    like(_raw, "%vi /etc/sudoers%"), "Sudoers File Edited",
    like(_raw, "%monitor capture%") OR like(_raw, "%span%") OR like(_raw, "%erspan%"), "Packet/Traffic Capture Command Detected",
    like(_raw, "%mycap.pcap%") OR like(_raw, "%tac.pcap%") OR like(_raw, "%1.pcap%"), "Suspicious PCAP Filename Detected",
    dest_port=57722, "Network Connection to IOS XR Backdoor Port 57722",
    match(dest_port, "^\d{3,5}22$"), "Network Connection to High Port Ending in '22'",
    1=1, "Unknown Match - Check Raw Event"
  )
-- Present the results in a clear table. Adjust fields as needed for your data sources.
| table _time, rule_name, reason, user, src_ip, dest_ip, dest_port, process, command, _raw
| `chinese_state-sponsored_network_device_activity_filter`
```