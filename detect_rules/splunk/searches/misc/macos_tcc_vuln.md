### Sploitlight: Analyzing a Spotlight-based macOS TCC vulnerability
---

Microsoft Threat Intelligence discovered "Sploitlight" (CVE-2025-31199), a macOS vulnerability that allows attackers to bypass Transparency, Consent, and Control (TCC) protections using malicious Spotlight plugins. This bypass enables the exfiltration of sensitive user data, including information cached by Apple Intelligence and data from iCloud-linked devices, without explicit user consent.

Beyond the article, recent intelligence highlights the severe implications of Sploitlight, particularly its ability to exfiltrate highly sensitive data like precise geolocation, facial recognition, and search history from Apple Intelligence caches, which can then be correlated across iCloud-linked devices. This makes the vulnerability more impactful than previous TCC bypasses due to the depth and breadth of data exposed.

### Actionable Threat Data
---

Monitor for the creation or modification of unsigned `.mdimporter` bundles in user-controlled Spotlight directories, specifically `~/Library/Spotlight`.

Detect the use of the mdimport utility with the `-r flag` to force Spotlight to load new bundles or with the `-i <path>` flag to recursively scan files, especially when targeting sensitive directories like `~/Downloads` or `~/Pictures`.

Look for suspicious activity in unified logs that indicate the exfiltration of file contents by Spotlight plugins, as this is the method used by Sploitlight to bypass TCC restrictions.

Identify attempts to modify `Info.plist` and `schema.xml` files within `.mdimporter` bundles to declare new file types for processing, as attackers can do this without recompilation.

Monitor for `mdworker` processes accessing files in TCC-protected directories without explicit user consent, particularly when initiated by unusual mdimport commands.

### Malicious Spotlight Importer / Suspicious mdimport Usage
---
```sql
| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Processes.process) as process from datamodel=Endpoint.Processes where Processes.process_name=mdimport by Processes.dest Processes.user
| `drop_dm_object_name(Processes)`
| `security_content_ctime(firstTime)`
| `security_content_ctime(lastTime)`
| where (like(mvjoin(process, " "), "% -r%")) AND (like(mvjoin(process, " "), "% -i %/Users/%/Downloads%") OR like(mvjoin(process, " "), "% -i %/Users/%/Pictures%") OR like(mvjoin(process, " "), "% -i %/Users/%/Desktop%") OR like(mvjoin(process, " "), "% -i %/Users/%/Documents%"))
| `suspicious_spotlight_importer_registration_and_indexing_filter`
```
---
```sql
| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Processes.process) as process from datamodel=Endpoint.Processes where Processes.process_name=mdimport by Processes.dest Processes.user
| `drop_dm_object_name(Processes)`
| `security_content_ctime(firstTime)`
| `security_content_ctime(lastTime)`
# This logic identifies the combination of forcing a Spotlight importer to be re-registered (-r flag)
# and then immediately indexing a sensitive user directory (-i flag).
| where (like(mvjoin(process, " "), "% -r %")) AND (like(mvjoin(process, " "), "% -i %/Users/%/Downloads%") OR like(mvjoin(process, " "), "% -i %/Users/%/Pictures%") OR like(mvjoin(process, " "), "% -i %/Users/%/Desktop%") OR like(mvjoin(process, " "), "% -i %/Users/%/Documents%"))
# Note: This behavior may be legitimate for developers or power users installing or debugging applications with Spotlight importers.
# Filter by user or parent process if false positives occur.
| `suspicious_mdimport_usage_filter`
```

### Spotlight Plugin Data Exfiltration
---
```sql
`macos_unified_logs` process_name IN ("mdworker", "mdworker_shared") ("POC: FILE @*" OR "POC: file @ leak at offset*")
| stats count min(_time) as firstTime max(_time) as lastTime values(message) as exfil_logs by dest, user, process_name
| `security_content_ctime(firstTime)`
| `security_content_ctime(lastTime)`
# This detection looks for specific log messages generated by the Sploitlight PoC.
# These messages indicate a malicious spotlight importer is reading a file and logging its contents.
| `spotlight_plugin_data_exfiltration_filter`
```

### mdimporter Info.plist Modification
---
```sql
| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Filesystem.process_name) as process_name from datamodel=Endpoint.Filesystem where (Filesystem.file_name IN ("Info.plist", "schema.xml") AND Filesystem.file_path LIKE "%/Library/Spotlight/%.mdimporter/%") by Filesystem.dest, Filesystem.user, Filesystem.file_path, Filesystem.file_name
| `drop_dm_object_name(Filesystem)`
| `security_content_ctime(firstTime)`
| `security_content_ctime(lastTime)`
# This search looks for modifications to configuration files within a users Spotlight Importer bundle.
# Attackers may modify these files to target sensitive data for exfiltration via the Sploitlight technique.
# Note: Legitimate application installers that include Spotlight importers may trigger this detection.
# Further tuning may be required to filter by process_name or user for specific environments.
| `mdimporter_info_plist_modification_filter`
```

### mdworker TCC Bypass
---
```sql
| tstats `security_content_summariesonly` dc(Filesystem.file_path) as distinct_file_count, values(Filesystem.file_path) as file_path from datamodel=Endpoint.Filesystem where (Filesystem.process_name IN ("mdworker", "mdworker_shared") AND (Filesystem.file_path LIKE "%/Users/%/Downloads/%" OR Filesystem.file_path LIKE "%/Users/%/Pictures/%" OR Filesystem.file_path LIKE "%/Users/%/Desktop/%" OR Filesystem.file_path LIKE "%/Users/%/Documents/%")) by _time span=5m, Filesystem.dest, Filesystem.user, Filesystem.process_name
| `drop_dm_object_name(Filesystem)`
| `security_content_ctime(_time)`
# This search identifies a high volume of file accesses by mdworker processes within TCC-protected user directories over a short time frame.
# This activity is indicative of the Sploitlight technique, where an attacker forces a recursive scan of a sensitive directory to exfiltrate data.
| where distinct_file_count > 50
# The threshold (distinct_file_count > 50) detects mass file access, characteristic of a malicious scan.
# This may require tuning. Legitimate but infrequent full folder re-indexing by Spotlight could cause false positives.
| `mdworker_tcc_bypass_filter`
```