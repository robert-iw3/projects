### Exploitation of Windows Server Update Services Remote Code Execution Vulnerability (CVE-2025-59287)
---

Threat actors are actively exploiting CVE-2025-59287, a critical deserialization vulnerability in Microsoft Windows Server Update Services (WSUS), to achieve remote code execution and exfiltrate sensitive information. This vulnerability allows unauthenticated attackers to execute arbitrary code with SYSTEM privileges by sending specially crafted requests to exposed WSUS instances.

Microsoft has released an out-of-band update to address CVE-2025-59287, as the initial Patch Tuesday fix was incomplete. This vulnerability has been added to CISA's Known Exploited Vulnerabilities Catalog, underscoring its critical nature and active exploitation in the wild.

### Actionable Threat Data
---

Monitor for cmd.exe or powershell.exe being spawned as child processes of w3wp.exe or wsusservice.exe. (T1059.001, T1059.003)

Detect PowerShell execution with base64 encoded commands, especially those attempting to enumerate network or user information and exfiltrate data to remote webhooks. (T1059.001, T1059.003, T1082, T1033, T1071.001)

Look for unusual outbound network connections from WSUS servers, particularly to webhook.site or other suspicious domains, indicating data exfiltration. (T1071.001)

Inspect WSUS log files (C:\Program Files\Update Services\Logfiles\SoftwareDistribution.log and C:\inetpub\logs\LogFiles\W3SVC*\u_ex*.log) for errors related to deserialization or unexpected POST requests to WSUS web services like /ReportingWebService/ReportingWebService.asmx or /ClientWebService/Client.asmx. (T1059.001, T1059.003)

Identify curl.exe or iwr (Invoke-WebRequest) commands used for data exfiltration, especially when originating from WSUS-related processes. (T1071.001)

### Consolidated TTP Search
---
```sql
-- Description: This query detects suspicious child processes and network connections originating from the Windows Server Update Services (WSUS) service process (wsusservice.exe) or the associated IIS worker process (w3wp.exe). This behavior is indicative of post-exploitation activity related to CVE-2025-59287, a remote code execution vulnerability in WSUS. The detection looks for command-line enumeration, encoded PowerShell commands, and data exfiltration to webhook sites.
-- References: https://www.huntress.com/blog/exploitation-of-windows-server-update-services-remote-code-execution-vulnerability
-- False Positive Sensitivity: Medium
-- Tags: CVE-2025-59287, WSUS, RCE, Exfiltration, PowerShell, w3wp.exe, wsusservice.exe

-- This search block looks for suspicious child processes spawned by WSUS or its associated IIS worker process.
(datamodel=Endpoint.Processes)
| `drop_dm_object_name("Processes")`
| where parent_process_name IN ("wsusservice.exe", "w3wp.exe")
| where (
    (process_name="powershell.exe" AND (process IN ("*net user /domain*", "*ipconfig /all*", "*webhook.site*", "*iwr -UseBasicParsing*", "*curl.exe*") OR process IN ("*-e *", "*-en *", "*-enc *", "*-encodedcommand *"))) OR
    (process_name="cmd.exe" AND process IN ("*net user /domain*", "*ipconfig /all*", "*webhook.site*", "*iwr -UseBasicParsing*", "*curl.exe*")) OR
    (process_name="curl.exe" AND process="*webhook.site*")
)
-- FP Tuning: Legitimate administrative scripts might be launched by w3wp.exe or wsusservice.exe.
-- Consider filtering by specific command lines or excluding known good scripts/servers if false positives occur.
| eval detection_method="Suspicious Child Process"
| table _time, dest, user, detection_method, parent_process_name, parent_process, process_name, process
| rename dest as host, user as account, parent_process as parent_process_cmd, process as child_process_cmd

| append [
    -- This search block looks for suspicious network connections made by WSUS or its associated IIS worker process.
    (datamodel=Network_Traffic.All_Traffic)
    | `drop_dm_object_name("All_Traffic")`
    | where process_name IN ("wsusservice.exe", "w3wp.exe") AND url="*webhook.site*"
    -- FP Tuning: If your organization uses webhook.site for legitimate purposes from these servers,
    -- you may need to add more specific filters or exclude known-good URLs.
    | eval detection_method="Suspicious Network Connection", parent_process_name=process_name, parent_process_cmd="N/A", process_name="N/A", child_process_cmd=url
    | table _time, dest, user, detection_method, parent_process_name, parent_process_cmd, process_name, child_process_cmd
    | rename dest as host, user as account
]
```