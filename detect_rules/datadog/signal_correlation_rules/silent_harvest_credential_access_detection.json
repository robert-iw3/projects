{
  "data": {
    "type": "signal_correlation",
    "attributes": {
      "name": "Silent Harvest Credential Access Detection",
      "enabled": true,
      "cases": [
        {
          "name": "WMI Child Process",
          "status": "high",
          "query": "source:sysmon @EventCode:1 @process.parent.name:WmiPrvSE.exe | aggregate count by @host.name, @user.name, @process.name, @process.command_line, @process.guid"
        },
        {
          "name": "Sensitive Registry Access",
          "status": "high",
          "query": "source:sysmon @EventCode:13 (@TargetObject:*\\SAM\\* OR @TargetObject:*\\SECURITY\\*) @user.name:-\"NT AUTHORITY\\SYSTEM\" | aggregate count by @host.name, @user.name, @process.name, @TargetObject, @process.guid"
        },
        {
          "name": "Large Outbound Upload",
          "status": "high",
          "query": "source:sysmon @EventCode:3 @network.direction:outbound @network.initiated:true @network.bytes_out>500000 | aggregate count by @host.name, @user.name, @process.name, @network.bytes_out, @network.source.ip, @network.destination.ip, @network.destination.port, @process.guid"
        }
      ],
      "group_by_fields": ["@host.name", "@network.source.ip", "@user.name", "@process.guid"],
      "distinct_fields": ["case_id"],
      "correlation": {
        "expression": "distinct_count >= 2",
        "timeframe": "30m"
      },
      "message": "Silent Harvest Activity Detected: {distinct_count} distinct TTPs on host {@host.name}, source IP {@network.source.ip}, or user {@user.name}. Techniques: {case_names}. Details: {@process.command_line OR @TargetObject OR @network.destination.ip}. Timeframe: {first_activity} to {last_activity}",
      "severity": "high",
      "tags": [
        "security:attack",
        "tactic:TA0006",
        "tactic:TA0010",
        "tactic:TA0011",
        "technique:T1003.002",
        "technique:T1047",
        "technique:T1041",
        "technique:T1134.001",
        "attack:silent_harvest"
      ],
      "filters": [
        {
          "query": "-@process.name:(outlook.exe OR teams.exe OR onedrive.exe OR msedge.exe OR chrome.exe OR firefox.exe OR gdrive.exe OR dropbox.exe OR Veeam.EndPoint.Service.exe)"
        }
      ],
      "options": {
        "evaluation_window": "30m"
      }
    }
  }
}