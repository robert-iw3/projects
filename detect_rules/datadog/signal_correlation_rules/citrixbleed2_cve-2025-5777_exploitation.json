{
  "data": {
    "type": "signal_correlation",
    "attributes": {
      "name": "CitrixBleed 2 (CVE-2025-5777) Exploitation Detection",
      "enabled": true,
      "cases": [
        {
          "name": "Malformed Login Requests",
          "status": "high",
          "query": "source:(pan* OR stream_http OR suricata OR cisco_ftd) @http.method:POST @http.url:*/p/u/doAuthentication.do @http.form_data:/login=(?:&|$)/ | aggregate count, min(@timestamp) AS first_seen, max(@timestamp) AS last_seen, collect(@http.url) AS urls, collect(@http.form_data) AS sample_post_bodies by @ip.src, @ip.dst, @user, @http.user_agent"
        },
        {
          "name": "Non-Printable Characters in Logs",
          "status": "high",
          "query": "source:citrix_netscaler @raw:/[^\\x20-\\x7E\\r\\n\\t]/ | aggregate count, min(@timestamp) AS first_seen, max(@timestamp) AS last_seen, collect(@raw) AS sample_logs by @host, @source"
        },
        {
          "name": "Multiple Sessions from Distinct IPs",
          "status": "high",
          "query": "source:citrix_netscaler \"SSLVPN TCPCONNSTAT\" | aggregate distinct_count(@client_ip) AS distinct_ip_count, collect(@client_ip) AS client_ips by @user window 10m | where distinct_ip_count > 1"
        },
        {
          "name": "Unauthorized Configuration Modifications",
          "status": "high",
          "query": "source:citrix_netscaler \"CMD_EXECUTED\" @command:(\"add aaa user*\" OR \"add system user*\" OR \"set aaa user*\" OR \"set system user*\" OR \"add system cmdpolicy*\" OR \"bind system user*\" OR \"save ns config*\" OR shell) | aggregate count, collect(@command) AS executed_commands by @timestamp, @host, @user, @client_ip"
        },
        {
          "name": "Suspicious Lateral Movement from NetScaler",
          "status": "high",
          "query": "source:(pan* OR cisco_asa OR zeek_conn OR corelight_conn) @ip.src:(10.0.0.5 OR 10.0.0.6) @port.dst:(135 OR 389 OR 445 OR 636 OR 3389 OR 5985 OR 5986) | aggregate count, collect(@port.dst) AS accessed_ports, distinct_count(@port.dst) AS distinct_ports_count by @timestamp, @ip.src, @ip.dst, @user"
        }
      ],
      "group_by_fields": ["@host", "@ip.src", "@user"],
      "distinct_fields": ["case_id"],
      "correlation": {
        "expression": "distinct_count >= 2",
        "timeframe": "1h"
      },
      "message": "CitrixBleed 2 (CVE-2025-5777) Exploitation Detected: {distinct_count} distinct TTPs on host {@host}, source IP {@ip.src}, or user {@user}. Techniques: {case_names}. Details: {@http.url OR @http.form_data OR @raw OR @client_ip OR @command OR @port.dst}. Timeframe: {first_activity} to {last_activity}",
      "severity": "high",
      "tags": [
        "security:attack",
        "tactic:TA0006",
        "technique:T1552.001",
        "technique:T1078.004",
        "environment:citrix",
        "vulnerability:citrixbleed2",
        "cve:CVE-2025-5777"
      ],
      "options": {
        "evaluation_window": "1h"
      }
    }
  }
}