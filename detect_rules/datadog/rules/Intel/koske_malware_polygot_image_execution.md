### Koske Malware: AI-Assisted Polyglot Threat
---

The Koske malware is a sophisticated Linux-based threat that leverages AI-generated code and polyglot image files to conduct stealthy cryptocurrency mining operations. It evades detection by hiding malicious payloads within seemingly benign images and executing code directly in memory, making it a significant challenge for traditional security measures.

Recent intelligence highlights Koske's advanced adaptive capabilities, including its use of AI to dynamically adjust its behavior, such as self-correcting C2 communication issues by altering proxy settings and DNS configurations. This AI-driven adaptability and the use of polyglot files for stealthy payload delivery represent a notable evolution in Linux malware, making it more resilient and harder to attribute.

### Actionable Threat Data
---

Monitor for the execution of grep piped to bash (e.g., grep -a -A9999 "# PAYLOAD" polyglot.jpg | bash), as this is a core technique used by Koske to execute embedded payloads from polyglot files.

Detect unusual modifications to system persistence mechanisms, such as .bashrc, crontab entries, or the creation of new systemd services, which Koske abuses to maintain access.

Look for the creation or modification of /etc/ld.so.preload or the use of the LD_PRELOAD environment variable, as Koske deploys rootkits using this technique to hide its presence.

Identify suspicious network connections initiated by curl or wget to unusual or newly observed IP addresses or domains, especially when originating from temporary directories or unexpected processes, indicating C2 communication or payload download.

Monitor for sudden and sustained spikes in CPU or GPU utilization on Linux systems, which could indicate the presence of unauthorized cryptocurrency mining activity.

### Combined Analysis Search
---
```sql
-- Name: Suspicious Linux Activity Associated with Koske Malware
-- Author: RW
-- Date: 2025-08-24
-- Description: This detection rule identifies multiple behaviors associated with the Koske malware on Linux systems. It combines several detection techniques into a single query, looking for polyglot file execution, persistence mechanism abuse, rootkit deployment, and suspicious C2 communications. An alert from this rule indicates one or more potentially malicious activities have occurred on a host and warrants investigation.
-- Data Source: Requires Datadog logs from Linux EDR agents (e.g., auditd, Sysmon) with process and file telemetry.

source:linux (
  -- TTP 1: Process-based detection (Polyglot, Persistence, Rootkit, C2)
  (
    process.name:(grep OR egrep) process.command:("*|*sh" OR "*|*bash")
    OR process.name:systemctl process.command:"*enable*.service"
    OR process.command:"*LD_PRELOAD=*"
    OR process.name:(curl OR wget)
  )
  -- TTP 2: File-based detection (Persistence, Rootkit)
  OR (
    file.action:(created OR modified) file.path:("*/.bashrc" OR "/etc/crontab" OR "/etc/cron.d/*" OR "/etc/systemd/system/*.service" OR "/etc/ld.so.preload")
  )
)
-- Exclude benign activities
-user:(puppet OR ansible) -parent_process.name:(yum OR apt-get)
| group by host, user
| select
    timestamp as _time,
    host,
    user,
    case(
      process.name:(grep OR egrep), "Polyglot Execution (grep | shell)",
      process.name:systemctl, "Persistence: Systemd Service Enabled",
      process.command:"*LD_PRELOAD=*", "Rootkit: LD_PRELOAD Env Var Used",
      process.name:(curl OR wget), "Suspicious C2 (curl/wget execution)",
      file.path:"/etc/ld.so.preload", "Rootkit: ld.so.preload Modified",
      *, "Persistence: Common File Modified"
    ) as detection_reason,
    coalesce(process.command, file.path) as event_detail,
    count
```