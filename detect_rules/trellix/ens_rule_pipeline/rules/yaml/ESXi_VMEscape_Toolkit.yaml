- type: expert
  name: Detect Known ESXi VM Escape Toolkit Malicious File Hashes
  content: |-
    Rule {
       Reaction SCAN ACTOR_PROCESS ScanAction REPORT
       Process {
          Include OBJECT_NAME { -v "**" }
       }
       Target {
          Match FILE {
             Include -hash "37972a232ac6d8c402ac4531430967c1fd458b74a52d6d1990688d88956791a7"
             Include -hash "4614346fc1ff74f057d189db45aa7dc25d6e7f3d9b68c287a409a53c86dca25e"
             Include -hash "c3f8da7599468c11782c2332497b9e5013d98a1030034243dfed0cf072469c89"
             Include -hash "2bc5d02774ac1778be22cace51f9e35fe7b53378f8d70143bf646b68d2c0f94c"
             Include -access "CREATE,WRITE,EXECUTE"
          }
       }
    }
  action: Report
  severity: Critical
  enabled: true
  description: "Detects creation, write, or execution of known malicious files matching SHA256 hashes from the 2025 ESXi VM Escape toolkit (MAESTRO). High-fidelity indicator; very low false positive rate."
- type: expert
  name: Detect VMware VMCI Device Disable via devcon.exe
  content: |-
    Rule {
       Reaction SCAN ACTOR_PROCESS ScanAction REPORT
       Process {
          Include OBJECT_NAME { -v "devcon.exe" }
       }
       Target {
          Match PROCESS {
             Include OBJECT_NAME { -v "**" }
             Include -access "CREATE"
             Include -command_line "*disable *VMCI*"
          }
       }
    }
  action: Report
  severity: High
  enabled: true
  description: "Detects devcon.exe disabling the VMware VMCI device â€” preparatory step for VM escape exploits in ESXi toolkit (2025 leaks). High-fidelity for VMware environments."
- type: expert
  name: Detect ESXi inetd.conf Modification (Backdoor Indicator)
  content: |-
    Rule {
       Reaction SCAN ACTOR_PROCESS ScanAction REPORT
       Process {
          Include OBJECT_NAME { -v "**" }
       }
       Target {
          Match FILE {
             Include OBJECT_NAME { -v "/var/run/inetd.conf" }
             Include -access "WRITE,CREATE,MODIFY"
          }
       }
    }
  action: Report
  severity: High
  enabled: true
  description: "Detects write/create/modify operations on /var/run/inetd.conf on ESXi/Linux hosts. Commonly abused to hijack network services (e.g., FTP) for backdoor persistence after VM escape (VSOCKpuppet-style techniques)."
- type: firewall
  name: Detect Unusual Outbound Traffic After Suspected ESXi Escape
  application: "**"
  direction: out
  protocol: "TCP,UDP"
  port: "21,22,80,443,445"
  action: Report
  severity: Medium
  enabled: false
  description: "Auxiliary rule: Detects outbound connections on common exfiltration/C2 ports (FTP, SSH, HTTP/S, SMB) following suspected ESXi compromise. Enable only after tuning; high false-positive risk without context or correlation."