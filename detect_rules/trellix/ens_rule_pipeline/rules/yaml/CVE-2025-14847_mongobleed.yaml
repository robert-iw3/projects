- type: firewall
  name: High Volume Inbound Connections to MongoDB Port - MongoBleed Exploit Indicator
  application: "**"
  direction: in
  protocol: TCP
  port: "27017"
  action: Report
  severity: High
  enabled: true
  description: "Detects potentially high-rate inbound TCP connections to MongoDB default port 27017 from external or anomalous sources. Characteristic of CVE-2025-14847 (MongoBleed) exploitation PoCs that flood the server with malformed zlib-compressed requests (often 50k+ connections/min). ENS Firewall cannot enforce per-minute thresholds natively â€” use as a trigger for correlation with network logs. Strongly recommend excluding known legitimate high-connection sources (application servers, monitoring tools) via source IP/application filters to reduce FPs."
- type: firewall
  name: Inbound MongoDB Traffic from External Networks
  application: "**"
  direction: in
  protocol: TCP
  port: "27017"
  action: Report
  severity: High
  enabled: true
  description: "Reports inbound connections to port 27017 (MongoDB) from non-internal IP ranges. High-fidelity indicator of unauthenticated exploitation attempts against exposed MongoDB instances vulnerable to CVE-2025-14847. Tune by excluding trusted IPs (e.g., app servers, scanners). Use ENS Web Control or firewall ACLs for blocking if needed."
- type: expert
  name: Detect MongoDB Config Modification (zlib Compression Disable)
  content: |-
    Rule {
       Reaction SCAN ACTOR_PROCESS ScanAction REPORT
       Process {
          Include OBJECT_NAME { -v "**" }
       }
       Target {
          Match FILE {
             Include OBJECT_NAME { -v "/etc/mongod.conf" -v "C:\\Program Files\\MongoDB\\Server\\**\\mongod.cfg" }
             Include -access "WRITE,CREATE,MODIFY"
          }
       }
    }
  action: Report
  severity: Medium
  enabled: true
  description: "Detects write/create/modify/delete operations on MongoDB config files. May indicate post-exploitation hardening (e.g., disabling zlib to mitigate CVE-2025-14847) or attacker tampering. Tune heavily for legitimate DBA/admin activity (exclude known admin tools/users)."
- type: expert
  name: Detect MongoDB Process Start with Exposed Port 27017
  content: |-
    Rule {
       Reaction SCAN ACTOR_PROCESS ScanAction REPORT
       Process {
          Include OBJECT_NAME { -v "mongod.exe" -v "mongod" -v "mongos.exe" -v "mongos" }
       }
       Target {
          Match PROCESS {
             Include OBJECT_NAME { -v "**" }
             Include -access "CREATE"
             Include -command_line "*--port*27017*"
             Include -command_line "*--bind_ip*0.0.0.0*"
             Include -command_line "*--bind_ip_all*"
          }
       }
    }
  action: Report
  severity: High
  enabled: true
  description: "Detects MongoDB (mongod/mongos) process creation with explicit or default binding to port 27017 and potentially insecure bind options (0.0.0.0 or --bind_ip_all). Strong indicator of an exposed instance vulnerable to CVE-2025-14847 exploitation. Very useful for asset discovery + risk prioritization."