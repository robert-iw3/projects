import "hash"

rule IOC_SharePoint_Exploitation_Hashes_Storm2603 {
    meta:
        description = "Detects malicious files (web shells, backdoors, and tools) associated with the exploitation of SharePoint vulnerabilities (e.g., CVE-2025-53770) by the threat actor Storm-2603. This rule matches known file hashes."
        author = "Rob Weber"
        date = "2025-07-24"
        version = 1
        reference = "https://www.microsoft.com/en-us/security/blog/2025/07/22/disrupting-active-exploitation-of-on-premises-sharepoint-vulnerabilities/"
        tags = "SHAREPOINT, STORM-2603, WEBSHELL, BACKDOOR, FILE, IOC"
        mitre_attack = "T1505.003, T1190"
        malware_family = "Storm-2603"
        malware_type = "Web Shell, Backdoor, Tool"

    condition:
        // This rule matches specific SHA256 hashes of files dropped during SharePoint exploitation campaigns.
        // The hashes correspond to spinstall*.aspx web shells, IIS backdoors, and other post-exploitation tools.
        hash.sha256 == "92bb4ddb98eeaf11fc15bb32e71d0a63256a0ed826a03ba293ce3a8bf057a514" or // spinstall0.aspx
        hash.sha256 == "24480dbe306597da1ba393b6e30d542673066f98826cc07ac4b9033137f37dbf" or // Web shell (http & curl)
        hash.sha256 == "b5a78616f709859a0d9f830d28ff2f9dbbb2387df1753739407917e96dadf6b0" or // Web shell (sockets & DNS)
        hash.sha256 == "c27b725ff66fdfb11dd6487a3815d1d1eba89d61b0e919e4d06ed3ac6a74fe94" or // Web shell (sockets & DNS)
        hash.sha256 == "1eb914c09c873f0a7bcf81475ab0f6bdfaccc6b63bf7e5f2dbf19295106af192" or // Web shell (sockets & DNS)
        hash.sha256 == "4c1750a14915bf2c0b093c2cb59063912dfa039a2adfe6d26d6914804e2ae928" or // IIS_Server_dll.dll
        hash.sha256 == "83705c75731e1d590b08f9357bc3b0f04741e92a033618736387512b40dab060" or // IIS_Server_dll.dll
        hash.sha256 == "f54ae00a9bae73da001c4d3d690d26ddf5e8e006b5562f936df472ec5e299441" or // IIS_Server_dll.dll
        hash.sha256 == "b180ab0a5845ed619939154f67526d2b04d28713fcc1904fbd666275538f431d" or // IIS_Server_dll.dll
        hash.sha256 == "6753b840cec65dfba0d7d326ec768bff2495784c60db6a139f51c5e83349ac4d" or // IIS_Server_dll.dll
        hash.sha256 == "7ae971e40528d364fa52f3bb5e0660ac25ef63e082e3bbd54f153e27b31eae68" or // IIS_Server_dll.dll
        hash.sha256 == "567cb8e8c8bd0d909870c656b292b57bcb24eb55a8582b884e0a228e298e7443" or // IIS_Server_dll.dll
        hash.sha256 == "445a37279d3a229ed18513e85f0c8d861c6f560e0f914a5869df14a74b679b86" or // IIS_Server_dll.dll
        hash.sha256 == "ffbc9dfc284b147e07a430fe9471e66c716a84a1f18976474a54bee82605fa9a" or // IIS_Server_dll.dll
        hash.sha256 == "6b273c2179518dacb1218201fd37ee2492a5e1713be907e69bf7ea56ceca53a5" or // IIS_Server_dll.dll
        hash.sha256 == "c2c1fec7856e8d49f5d49267e69993837575dbbec99cd702c5be134a85b2c139" or // IIS_Server_dll.dll
        hash.sha256 == "d6da885c90a5d1fb88d0a3f0b5d9817a82d5772d5510a0773c80ca581ce2486d" or // SharpHostInfo.x64.exe
        hash.sha256 == "62881359e75c9e8899c4bc9f452ef9743e68ce467f8b3e4398bebacde9550dea"    // xd.exe
}
