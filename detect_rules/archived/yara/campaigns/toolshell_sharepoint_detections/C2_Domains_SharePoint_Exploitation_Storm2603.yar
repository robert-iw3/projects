rule C2_Domains_SharePoint_Exploitation_Storm2603 {
    meta:
        description = "Detects files containing command and control (C2) domains (e.g., c34718cbb4c6.ngrok-free.app, updatemicfosoft.com) associated with the exploitation of SharePoint vulnerabilities by threat actor Storm-2603."
        author = "Rob Weber"
        date = "2025-07-24"
        version = 1
        reference = "https://www.microsoft.com/en-us/security/blog/2025/07/22/disrupting-active-exploitation-of-on-premises-sharepoint-vulnerabilities/"
        tags = "SHAREPOINT, STORM-2603, C2, DOMAIN, FILE"
        mitre_attack = "T1090"
        malware_family = "Storm-2603"
        malware_type = "Backdoor, Web Shell, Tool"

    strings:
        // C2 domains used by Storm-2603 in SharePoint exploitation campaigns.
        $domain1 = "c34718cbb4c6.ngrok-free.app" wide ascii
        $domain2 = "msupdate.updatemicfosoft.com" wide ascii
        $domain3 = "update.updatemicfosoft.com" wide ascii

    condition:
        // This rule detects files containing hardcoded C2 domains.
        // While these domains are specific, they could appear in benign files like threat intelligence reports or logs.
        // Consider excluding file paths where such reports are stored to reduce potential false positives.
        filesize < 10MB and
        1 of ($domain*)
}
