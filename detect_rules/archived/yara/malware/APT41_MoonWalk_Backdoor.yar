import "pe"

rule APT41_MoonWalk_Backdoor
{
    meta:
        description = "Detects the MoonWalk backdoor, used by APT41. This rule identifies the malware based on its unique mutex string and other embedded artifacts related to its C2 communication and configuration."
        author = "RW"
        date = "2025-07-30"
        version = 1
        reference = "https://www.zscaler.com/blogs/security-research/moonwalk-deep-dive-updated-arsenal-apt41-part-2"
        hash = "5b1e8455291d99a1724327b9a7fc2616"
        hash = "bfd6286bb39a0e24a2af28c63bd8e194"
        tags = "APT, APT41, BACKDOOR, MOONWALK, FILE"
        mitre_attack = "T1027, T1102.002, T1573, T1592"
        malware_family = "MoonWalk"
        malware_type = "Backdoor"

    strings:
        // Specific mutex used by MoonWalk to ensure a single instance.
        $mutex = "Global\\ctXjvsAxpzyqElmk" wide

        // User-Agent string used for C2 communications over Google Drive.
        $ua = "curl/7.54.0" ascii

        // String related to the custom ECDH implementation for key exchange.
        $crypto_func = "curve25519_donna" ascii

        // Suffix for Google OAuth Client IDs found in the configuration.
        $gdrive_oauth = ".apps.googleusercontent.com" wide

        // Default configuration name.
        $config_name = "default" wide

    condition:
        // The rule targets PE files, likely DLLs, under 2MB.
        pe.is_pe
        and filesize < 2MB
        // The primary indicator is the unique mutex string.
        and $mutex
        // To increase confidence, at least two other characteristic strings must be present.
        // This could indicate C2, crypto, or configuration artifacts.
        and 2 of ($ua, $crypto_func, $gdrive_oauth, $config_name)
}
