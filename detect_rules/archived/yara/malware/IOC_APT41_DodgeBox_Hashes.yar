import "hash"

rule IOC_APT41_DodgeBox_Hashes
{
    meta:
        description = "Detects files associated with APT41's DodgeBox loader, MoonWalk backdoor, and StealthVector loader based on known MD5 hashes."
        author = "RW"
        date = "2025-07-30"
        version = 1
        reference = "https://www.zscaler.com/blogs/security-research/dodgebox-deep-dive-updated-arsenal-apt41-part-1"
        hash = "0d068b6d0523f069d1ada59c12891c4a" // MD5: Music.zip
        hash = "b3067f382d70705d4c8f6977a7d7bee4" // MD5: taskhost.exe
        hash = "d72f202c1d684c9a19f075290a60920f" // MD5: Sbiedll.dll (DodgeBox)
        hash = "294cc02db5a122e3a1bc4f07997956da" // MD5: Sbiedll.dat (MoonWalk)
        hash = "393065ef9754e3f39b24b2d1051eab61" // MD5: Atstrust.dll (DodgeBox)
        hash = "bcac2cbda36019776d7861f12d9b59c4" // MD5: Atstrust.dat (MoonWalk)
        hash = "f062183da590aba5e911d2392bc29181" // MD5: AppRouted.dll (StealthVector)
        hash = "4141c4b827ff67c180096ff5f2cc1474" // MD5: AppRouteing.dll (StealthVector Payload)
        hash = "bc85062de0f70afd44bb072b0b71a8cc" // MD5: N/A (StealthVector)
        hash = "72070b165d1f11bd4d009a81bf28a3e5" // MD5: mscms.dll (StealthVector)
        hash = "f0953ed4a679b987a2da955788737602" // MD5: roboform-x64.dll (StealthVector)
        tags = "APT, APT41, DODGEBOX, STEALTHVECTOR, MOONWALK, FILE"
        mitre_attack = "T1574.002"
        malware_family = "DodgeBox"
        malware_type = "Loader"

    condition:
        // Match any of the provided MD5 hashes for DodgeBox and related components.
        hash.md5(0, filesize) == "0d068b6d0523f069d1ada59c12891c4a" or
        hash.md5(0, filesize) == "b3067f382d70705d4c8f6977a7d7bee4" or
        hash.md5(0, filesize) == "d72f202c1d684c9a19f075290a60920f" or
        hash.md5(0, filesize) == "294cc02db5a122e3a1bc4f07997956da" or
        hash.md5(0, filesize) == "393065ef9754e3f39b24b2d1051eab61" or
        hash.md5(0, filesize) == "bcac2cbda36019776d7861f12d9b59c4" or
        hash.md5(0, filesize) == "f062183da590aba5e911d2392bc29181" or
        hash.md5(0, filesize) == "4141c4b827ff67c180096ff5f2cc1474" or
        hash.md5(0, filesize) == "bc85062de0f70afd44bb072b0b71a8cc" or
        hash.md5(0, filesize) == "72070b165d1f11bd4d009a81bf28a3e5" or
        hash.md5(0, filesize) == "f0953ed4a679b987a2da955788737602"
}
