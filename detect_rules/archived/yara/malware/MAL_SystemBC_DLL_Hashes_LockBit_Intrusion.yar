import "pe"
import "hash"

rule MAL_SystemBC_DLL_Hashes_LockBit_Intrusion
{
    meta:
        description = "Detects SystemBC DLLs based on their SHA256 hashes. These samples were observed being used for persistence and command and control in a LockBit ransomware intrusion."
        date = "2025-07-27"
        version = 1
        hash = "2389b3978887ec1094b26b35e21e9c77826d91f7fa25b2a1cb5ad836ba2d7ec4"
        hash = "44cf04192384e920215f0e335561076050129ad7a43b58b1319fa1f950f6a7b6"
        tags = "CRIME, RANSOMWARE, LOCKBIT, SYSTEMBC, FILE"
        mitre_attack = "T1547.001, T1053.005"
        malware_family = "SystemBC"
        malware_type = "Proxy"

    condition:
        // This rule matches specific file hashes and is therefore high-fidelity.
        // It first verifies the file is a PE executable (like a DLL).
        pe.is_pe and
        (
            // Matches known SHA256 hashes of SystemBC DLLs from the incident.
            hash.sha256(0, filesize) == "2389b3978887ec1094b26b35e21e9c77826d91f7fa25b2a1cb5ad836ba2d7ec4" or
            hash.sha256(0, filesize) == "44cf04192384e920215f0e335561076050129ad7a43b58b1319fa1f950f6a7b6"
        )
}
