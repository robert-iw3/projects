import "pe"

rule MAL_Skynet_Tor_Client_Deployment
{
    meta:
        description = "Detects malware that drops and executes a Tor client in a 'skynet' subdirectory of the TEMP folder. This behavior is characteristic of the Skynet malware, used to establish covert C2 communications."
        date = "2025-07-24"
        version = 1
        reference = "https://research.checkpoint.com/2025/ai-evasion-prompt-injection/"
        hash = "6cdf54a6854179bf46ad7bc98d0a0c0a6d82c804698d1a52f6aa70ffa5207b02"
        tags = "FILE, MALWARE, SKYNET, TOR, C2"
        mitre_attack = "T1105, T1071.001"
        malware_family = "Skynet"
        malware_type = "Proxy, Dropper"

    strings:
        // Specific command-line arguments used to launch the dropped Tor client
        $cmd1 = "--ControlPort 127.0.0.1:24616" wide ascii
        $cmd2 = "--SocksPort 127.0.0.1:24615" wide ascii
        $cmd3 = "--Log \\\"notice stdout\\\"" wide ascii // Note: The inner quotes are escaped for the command line

        // Path artifact where the Tor client is written
        $path1 = "/skynet/tor.exe" wide ascii

    condition:
        // Target PE files
        pe.is_pe
        and
        (
            // High confidence: two of the specific command-line arguments are present
            2 of ($cmd*)
            or
            // Medium confidence: the unique path combined with any of the command-line arguments
            // This combination is highly specific to this malware's behavior.
            ($path1 and 1 of ($cmd*))
        )
}
