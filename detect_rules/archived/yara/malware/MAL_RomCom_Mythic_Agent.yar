import "pe"

rule MAL_RomCom_Mythic_Agent_Payload_CVE_2025_8088
{
    meta:
        description = "Detects the Mythic agent payload (msedge.dll) deployed by the RomCom group during the exploitation of the WinRAR vulnerability CVE-2025-8088. The rule identifies the malware based on specific configuration strings found in the payload."
        author = "RW"
        date = "2025-08-15"
        version = 1
        reference = "https://www.welivesecurity.com/en/eset-research/update-winrar-tools-now-romcom-and-others-exploiting-zero-day-vulnerability/"
        hash = "AE687BEF963CB30A3788E34CC18046F54C41FFBA" // SHA1 of msedge.dll
        tags = "FILE, APT, LOADER, ROMCOM, MYTHIC"
        mitre_attack = "T1071.001, T1546.015"
        malware_family = "RomCom"
        malware_type = "Agent"

    strings:
        // Mythic agent custom configuration strings mentioned in the report
        $cfg_1 = "disable_etw" ascii wide
        $cfg_2 = "block_non_ms_dlls" ascii wide
        $cfg_3 = "child_process" ascii wide
        $cfg_4 = "wmic.exe" ascii wide
        $cfg_5 = "use_winhttp" ascii wide
        $cfg_6 = "inject_method" ascii wide
        $cfg_7 = "dll_side" ascii wide
        $cfg_8 = "MsEdge" ascii wide
        $cfg_9 = "OneDrive" ascii wide

    condition:
        // Check for PE file type
        pe.is_pe
        // Scope to typical payload sizes to reduce scanning overhead
        and filesize < 2MB
        // Require multiple configuration strings to increase confidence and reduce FPs
        and 4 of ($cfg_*)
}
