import "pe"
import "hash"

rule MAL_GhostSOCKS_Hashes_LockBit_Intrusion
{
    meta:
        description = "Detects GhostSOCKS binaries based on their SHA256 hashes. These samples were observed being used for persistence and command and control in a LockBit ransomware intrusion."
        date = "2025-07-27"
        version = 1
        hash = "ced4ee8a9814c243f0c157cda900def172b95bb4bc8535e480fe432ab84b9175"
        hash = "b4ad5df385ee964fe9a800f2cdaa03626c8e8811ddb171f8e821876373335e63"
        tags = "CRIME, RANSOMWARE, LOCKBIT, GHOSTSOCKS, FILE"
        mitre_attack = "T1547.001, T1053.005"
        malware_family = "GhostSOCKS"
        malware_type = "Proxy"

    condition:
        // This rule matches specific file hashes and is therefore high-fidelity.
        // It first verifies the file is a PE executable.
        pe.is_pe and
        (
            // Matches known SHA256 hashes of GhostSOCKS binaries from the incident.
            hash.sha256(0, filesize) == "ced4ee8a9814c243f0c157cda900def172b95bb4bc8535e480fe432ab84b9175" or
            hash.sha256(0, filesize) == "b4ad5df385ee964fe9a800f2cdaa03626c8e8811ddb171f8e821876373335e63"
        )
}
