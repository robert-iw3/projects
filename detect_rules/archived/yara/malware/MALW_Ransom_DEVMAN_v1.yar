import "pe"

rule MALW_Ransom_DEVMAN_v1 : RANSOMWARE DEVMAN DRAGONFORCE FILE
{
    meta:
        description = "Detects DEVMAN ransomware, a variant of DragonForce, based on unique strings related to its mutex, deterministic file renaming, and internal functionalities observed in analysis."
        date = "2025-07-03"
        version = 1
        reference = "https://any.run/cybersecurity-blog/devman-ransomware-analysis/"
        tags = "RANSOMWARE, DEVMAN, DRAGONFORCE, FILE"
        mitre_attack = "T1486, T1027, T1070, T1135, T1021.002"
        malware_family = "DEVMAN"
        malware_type = "Ransomware"

    strings:
        // Unique hardcoded mutex name
        $s1 = "hsfjuukjzloqu28oajh727190" ascii wide

        // Part of the deterministic filename for encrypted ransom notes
        $s2 = "e47qfsnz2trbkhnt" ascii wide

        // File extension used for encrypted files
        $s3 = ".DEVMAN" ascii wide

        // String related to Windows Restart Manager interaction for file lock evasion
        $s4 = "RestartManager\\Session0000" ascii wide

        // Unique debug/internal string identified via FLOSS
        $s5 = "NOIGLX" ascii wide

        // Strings indicating different encryption modes
        $s6 = "Full encrypt" ascii wide
        $s7 = "Header encrypt" ascii wide
        $s8 = "20% encrypt" ascii wide
        $s9 = "%%30%% encrypt" ascii wide

        // String related to SMB share targeting
        $s10 = "ADMIN$" ascii wide

        // String from the ransom note content, potentially embedded in the binary
        $s11 = "DragonForce Ransomware Cartel" ascii wide

    condition:
        // Must be a PE file
        pe.is_pe
        // Limit file size to avoid scanning excessively large files, typical for ransomware
        and filesize < 10MB
        // Require at least one of the highly unique identifiers (mutex or deterministic filename)
        and ($s1 or $s2)
        // Require at least one of the other strong indicators (extension, RestartManager, or unique debug string)
        and ($s3 or $s4 or $s5)
        // Require at least two of the encryption mode strings to confirm ransomware functionality
        and 2 of ($s6, $s7, $s8, $s9)
        // Optionally include the SMB share string or ransom note content string for additional confidence
        and ($s10 or $s11)
}