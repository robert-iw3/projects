rule Detect_Campaign_CrossC2_ReadNimeLoader {
    meta:
        author = "RW"
        date = "2025-08-15"
        description = "Detects components of the CrossC2/ReadNimeLoader campaign, including the loader, CrossC2 beacon, and embedded Cobalt Strike artifacts. This rule is based on unique strings and patterns found in the malware samples."
        reference = "https://blogs.jpcert.or.jp/en/2025/08/crossc2.html"

    strings:
        // ReadNimeLoader - Specific PDB path
        $pdb_readnimeloader = "D:\\BuildServer\\bna-4\\work-git\\phoenix-repository\\phoenix\\Release\\Battle.net Launcher.exe.pdb" ascii

        // OdinLdr - Unique string found in heap memory
        $str_odinldr = "OdinLdr1337" ascii

        // CrossC2 - Configuration search tag and junk code pattern
        $str_crossc2_hook = "HOOK" ascii
        $hex_crossc2_junk = { 8B 85 [4] 2D [4] 89 85 [4] 0F 84 [4] E9 00 00 00 00 }

        // Cobalt Strike Beacon - Specific artifacts from the configuration
        $str_cs_ua = "AppleWebKit/537.36 (KHTML, like Gecko) Teams/1.4.00.2879 Chrome/80.0.3987.165 Electron/8.5.1 Safari/537.36" ascii wide
        $str_cs_uri = "/MkuiIJzM2IZs" ascii
        $str_cs_watermark = "987654321" ascii

        // C2 Domains from the report
        $c2_domain1 = "api.glazeceramics.com" ascii
        $c2_domain2 = "doc.docu-duplicator.com" ascii

    condition:
        // Check for PE/ELF file headers to reduce false positives
        (uint16(0) == 0x5a4d or uint32(0) == 0x464c457f) and
        (
            $pdb_readnimeloader or
            $str_odinldr or
            // For CrossC2, require the HOOK string and the junk code pattern
            ( $str_crossc2_hook and $hex_crossc2_junk ) or
            // For Cobalt Strike, require 2 of the specific strings
            ( 2 of ($str_cs_*) ) or
            // Detect if any of the C2 domains are present
            ( 1 of ($c2_domain*) )
        )
}