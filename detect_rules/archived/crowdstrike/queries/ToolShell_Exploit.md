### CrowdStrike (Falcon Query Language)
---

### Hunting Query for Exploitation Chain (cmd.exe -> PowerShell -> ASPX Write):
---
```sql
correlate(
    cmd: {
        event_simpleName=ProcessRollup2 event_platform=Win FileName="cmd.exe" ParentBaseFileName="w3wp.exe"
    } include: [aid, ComputerName, TargetProcessId, ParentBaseFileName, FileName, CommandLine],
    pwsh: {
        event_simpleName=ProcessRollup2 event_platform=Win FileName="powershell.exe"
        | aid <=> cmd.aid
        | ParentProcessId <=> cmd.TargetProcessId
    } include: [aid, ComputerName, TargetProcessId, ParentBaseFileName, FileName, CommandLine],
    aspx: {
        event_simpleName=/^(NewScriptWritten|WebScriptFileWritten)$/ event_platform=Win FileName=/\.aspx/i
        | aid <=> cmd.aid
        | ContextProcessId <=> pwsh.TargetProcessId
    } include: [aid, ComputerName, TargetFileName],
sequence=true, within=5m)
```

### Detection Rule for Malicious POST Requests:
---
```sql
Vendor="microsoft" event.module="iis" event.dataset="iis.access" repo!="xdr*"
    | http.request.method="POST" url.path="/_layouts/15/ToolPane.aspx" url.query="DisplayMode=Edit&a=/ToolPane.aspx" http.request.referrer="/_layouts/SignOut.aspx"
    | http.response.status_code =~ in(values=[200,302])
```