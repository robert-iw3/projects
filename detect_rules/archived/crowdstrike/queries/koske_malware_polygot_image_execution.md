### Koske Malware: AI-Assisted Polyglot Threat
---

The Koske malware is a sophisticated Linux-based threat that leverages AI-generated code and polyglot image files to conduct stealthy cryptocurrency mining operations. It evades detection by hiding malicious payloads within seemingly benign images and executing code directly in memory, making it a significant challenge for traditional security measures.

Recent intelligence highlights Koske's advanced adaptive capabilities, including its use of AI to dynamically adjust its behavior, such as self-correcting C2 communication issues by altering proxy settings and DNS configurations. This AI-driven adaptability and the use of polyglot files for stealthy payload delivery represent a notable evolution in Linux malware, making it more resilient and harder to attribute.

### Actionable Threat Data
---

Monitor for the execution of grep piped to bash (e.g., grep -a -A9999 "# PAYLOAD" polyglot.jpg | bash), as this is a core technique used by Koske to execute embedded payloads from polyglot files.

Detect unusual modifications to system persistence mechanisms, such as .bashrc, crontab entries, or the creation of new systemd services, which Koske abuses to maintain access.

Look for the creation or modification of /etc/ld.so.preload or the use of the LD_PRELOAD environment variable, as Koske deploys rootkits using this technique to hide its presence.

Identify suspicious network connections initiated by curl or wget to unusual or newly observed IP addresses or domains, especially when originating from temporary directories or unexpected processes, indicating C2 communication or payload download.

Monitor for sudden and sustained spikes in CPU or GPU utilization on Linux systems, which could indicate the presence of unauthorized cryptocurrency mining activity.

### Combined Analysis Search
---
```sql
-- Name: Suspicious Linux Activity Associated with Koske Malware
-- Author: RW
-- Date: 2025-08-24
-- Description: This detection rule identifies multiple behaviors associated with the Koske malware on Linux systems. It combines several detection techniques into a single query, looking for polyglot file execution, persistence mechanism abuse, rootkit deployment, and suspicious C2 communications. An alert from this rule indicates one or more potentially malicious activities have occurred on a host and warrants investigation.
-- Data Source: Requires CrowdStrike Falcon EDR with process, file, and network event telemetry.

event_platform=Linux (
  -- TTP 1: Polyglot Execution, Persistence, Rootkit, and C2 via Process Events
  (
    -- Polyglot execution: grep piping to shell
    (event_type=ProcessRollup2 ProcessName=/\b(grep|egrep)\b/ CommandLine=/.*\|.*(sh|bash)/)
    -- Persistence: systemctl enabling services
    OR (event_type=ProcessRollup2 ProcessName=/\bsystemctl\b/ CommandLine=/.*enable.*\.service/)
    -- Rootkit: LD_PRELOAD usage
    OR (event_type=ProcessRollup2 CommandLine=/.*LD_PRELOAD=.*/)
    -- Suspicious C2: curl or wget execution
    OR (event_type=ProcessRollup2 ProcessName=/\b(curl|wget)\b/)
  )
  -- TTP 2: Persistence and Rootkit via File Modifications
  OR (
    event_type=FileWriteEvent FileName IN ("*/.bashrc", "/etc/crontab", "/etc/cron.d/*", "/etc/systemd/system/*.service", "/etc/ld.so.preload")
  )
)
-- Filter out known benign activities
| NOT (UserName IN ("puppet", "ansible") OR ParentBaseFileName IN ("yum", "apt-get"))
| group by aid, UserName, event_time
| select
    event_time,
    aid as host,
    UserName as user,
    case(
      ProcessName=/\b(grep|egrep)\b/, "Polyglot Execution (grep | shell)",
      ProcessName=/\bsystemctl\b/, "Persistence: Systemd Service Enabled",
      CommandLine=/.*LD_PRELOAD=.*/, "Rootkit: LD_PRELOAD Env Var Used",
      ProcessName=/\b(curl|wget)\b/, "Suspicious C2 (curl/wget execution)",
      FileName="/etc/ld.so.preload", "Rootkit: ld.so.preload Modified",
      true, "Persistence: Common File Modified"
    ) as detection_reason,
    coalesce(CommandLine, FileName) as event_detail,
    count() as event_count
```