### Zero Click, One NTLM: Microsoft Security Patch Bypass (CVE-2025-50154)
---

A new zero-click NTLM credential leakage vulnerability (CVE-2025-50154) has been discovered that bypasses Microsoft's patch for CVE-2025-24054, allowing attackers to extract NTLM hashes and silently download remote binaries without user interaction. This vulnerability significantly increases the attack surface for organizations, enabling offline cracking, relay attacks, privilege escalation, lateral movement, and the staging of malicious payloads.

This new vulnerability demonstrates a critical bypass of a previous Microsoft patch, highlighting that even patched systems can remain vulnerable to NTLM credential theft and silent binary delivery through a subtle gap in mitigation. The ability to download malicious binaries without execution or user interaction is a significant evolution, as it allows for stealthy payload delivery that can evade many traditional security controls.

### Actionable Threat Data
---

Suspicious LNK file creation with remote target or icon paths: Monitor for the creation of .lnk files where TargetPath or IconLocation point to remote SMB shares (e.g., \\<IP_Address>\share\execute.exe or \\<IP_Address>\share\icon.ico).

NTLM authentication attempts from explorer.exe to untrusted external IPs: Look for explorer.exe initiating NTLM authentication requests to IP addresses or domains not typically associated with internal network resources.

Unusual file creations in user profile directories originating from explorer.exe: Detect the creation of executable files (e.g., .exe, .dll) in user-writable directories (e.g., C:\Users\<username>\AppData\Local\Temp) where the parent process is explorer.exe and the file was downloaded from a remote share.

Network connections from explorer.exe to SMB shares for executable or icon files: Monitor explorer.exe making outbound network connections to SMB shares, specifically when requesting .exe, .dll, or .ico file types.

PowerShell script execution creating LNK files with remote paths: Identify PowerShell scripts that utilize New-Object -ComObject WScript.Shell to create shortcuts (.lnk) with TargetPath or IconLocation attributes pointing to remote network paths.

### Splunk
---
```sql
-- Note: This query is written for a generic EDR data source. You must replace `"<your_edr_index>"` with your actual index and update field names (e.g., `ProcessName`, `CommandLine`, `dest_port`, `TargetFileName`, `Url`, `dest_ip`) to match your data model (e.g., CrowdStrike, Carbon Black, Sysmon).

(index="<your_edr_index>")
-- Part 1: Detects PowerShell creating a .LNK file with a remote path.
(sourcetype="<powershell_log_sourcetype>" OR (sourcetype="<process_log_sourcetype>" (ProcessName="powershell.exe" OR ParentProcessName="powershell.exe")))
`comment("Look for PowerShell creating a shortcut using the WScript.Shell COM object")`
(CommandLine="*WScript.Shell*" AND CommandLine="*CreateShortcut*")
`comment("Identify where the TargetPath or IconLocation is set to a remote UNC path (e.g., \\\\server\\share)")`
| regex CommandLine="(?i)(\.TargetPath|\.IconLocation)\s*=\s*[\"'].*?\\\\"
| eval DetectionMethod="PowerShell LNK Creation with Remote Path", Evidence=CommandLine, SuspiciousProcess=ProcessName, SuspiciousCommandLine=CommandLine
| fields _time, host, DetectionMethod, Evidence, SuspiciousProcess, SuspiciousCommandLine, user

| append [
    -- Part 2: Detects Explorer.exe connecting to a remote SMB share.
    search (index="<your_edr_index>") sourcetype="<network_log_sourcetype>" ProcessName="explorer.exe" dest_port=445
    `comment("This logic detects connections to remote shares for specific file types OR connections to any external (non-private) IP address.")`
    | where (match(Url, "(?i)\.(exe|dll|ico)$") OR (isnotnull(dest_ip) AND NOT (cidrmatch("10.0.0.0/8", dest_ip) OR cidrmatch("172.16.0.0/12", dest_ip) OR cidrmatch("192.168.0.0/16", dest_ip) OR cidrmatch("127.0.0.1", dest_ip))))
    | eval DetectionMethod="Explorer.exe SMB Connection for Remote File", Evidence="RemoteUrl: ".Url.", RemoteIP: ".dest_ip, SuspiciousProcess=ProcessName, SuspiciousCommandLine=CommandLine
    | fields _time, host, DetectionMethod, Evidence, SuspiciousProcess, SuspiciousCommandLine, user
]
| append [
    -- Part 3: Detects Explorer.exe creating an executable file in a temp location.
    search (index="<your_edr_index>") sourcetype="<file_creation_log_sourcetype>" ProcessName="explorer.exe" (TargetFileName="*.exe" OR TargetFileName="*.dll")
    `comment("Focus on temporary or cache directories within user profiles where remotely fetched files are often stored.")`
    (TargetFileName="*\\AppData\\Local\\Temp\\*" OR TargetFileName="*\\AppData\\Local\\Microsoft\\Windows\\INetCache\\*")
    | eval DetectionMethod="Explorer.exe Created Executable in Temp Directory", Evidence="File: ".TargetFileName.", Path: ".FolderPath, SuspiciousProcess=ProcessName, SuspiciousCommandLine=CommandLine
    | fields _time, host, DetectionMethod, Evidence, SuspiciousProcess, SuspiciousCommandLine, user
]
-- Normalize field names for final output
| rename host as DeviceName, user as AccountName
| table _time, DeviceName, AccountName, DetectionMethod, Evidence, SuspiciousProcess, SuspiciousCommandLine
```

### Crowdstrike
---
```sql
-- Part 1: PowerShell creating a .LNK file with a remote path

event_platform=Win event_simpleName IN (ProcessRollup2, SyntheticProcessRollup2)
(CommandLine:"*WScript.Shell*" CommandLine:"*CreateShortcut*" (ImageFileName:"\\powershell.exe" OR ParentBaseFileName:"\\powershell.exe"))
CommandLine:/(?i)(\.TargetPath|\.IconLocation)\s*=\s*["'].*?\\\\/
| project timestamp, ComputerName, DetectionMethod="PowerShell LNK Creation with Remote Path", Evidence=CommandLine, SuspiciousProcess=ImageFileName, SuspiciousCommandLine=CommandLine, UserName

-- Part 2: Explorer.exe connecting to a remote SMB share

event_platform=Win event_simpleName=NetworkConnect
ImageFileName:"\\explorer.exe" RemotePort=445
(RemoteAddress!~"10.0.0.0/8" RemoteAddress!~"172.16.0.0/12" RemoteAddress!~"192.168.0.0/16" RemoteAddress!~"127.0.0.1" OR TargetUrl:/(?i)\.(exe|dll|ico)$/)
| project timestamp, ComputerName, DetectionMethod="Explorer.exe SMB Connection for Remote File", Evidence=strcat("RemoteUrl: ", TargetUrl, ", RemoteIP: ", RemoteAddress), SuspiciousProcess=ImageFileName, SuspiciousCommandLine=CommandLine, UserName

-- Part 3: Explorer.exe creating an executable in a temp location

event_platform=Win event_simpleName=FileWrite
ImageFileName:"\\explorer.exe" (TargetFileName:/\.exe$/ OR TargetFileName:/\.dll$/)
(TargetFileName:/\\AppData\\Local\\Temp\\/ OR TargetFileName:/\\AppData\\Local\\Microsoft\\Windows\\INetCache\\/)
| project timestamp, ComputerName, DetectionMethod="Explorer.exe Created Executable in Temp Directory", Evidence=strcat("File: ", TargetFileName, ", Path: ", TargetFileName), SuspiciousProcess=ImageFileName, SuspiciousCommandLine=CommandLine, UserName
```

### Datadog
---
```sql
-- Part 1: PowerShell creating a .LNK file with a remote path

source:edr (powershell OR process_name:powershell.exe OR parent_process_name:powershell.exe) "WScript.Shell" "CreateShortcut" /(?i)(\.TargetPath|\.IconLocation)\s*=\s*["'].*?\\\\/
| select @timestamp, host, DetectionMethod="PowerShell LNK Creation with Remote Path", Evidence=command_line, SuspiciousProcess=process_name, SuspiciousCommandLine=command_line, user

-- Part 2: Explorer.exe connecting to a remote SMB share

source:network process_name:explorer.exe destination_port:445
(url:/(?i)\.(exe|dll|ico)$/ OR (destination_ip:* -destination_ip:10.0.0.0/8 -destination_ip:172.16.0.0/12 -destination_ip:192.168.0.0/16 -destination_ip:127.0.0.1))
| select @timestamp, host, DetectionMethod="Explorer.exe SMB Connection for Remote File", Evidence=strcat("RemoteUrl: ", url, ", RemoteIP: ", destination_ip), SuspiciousProcess=process_name, SuspiciousCommandLine=command_line, user

-- Part 3: Explorer.exe creating an executable in a temp location

source:edr process_name:explorer.exe (file_name:*.exe OR file_name:*.dll) (file_name:*\\AppData\\Local\\Temp\\* OR file_name:*\\AppData\\Local\\Microsoft\\Windows\\INetCache\\*)
| select @timestamp, host, DetectionMethod="Explorer.exe Created Executable in Temp Directory", Evidence=strcat("File: ", file_name, ", Path: ", file_path), SuspiciousProcess=process_name, SuspiciousCommandLine=command_line, user
```

### Elastic
---
```sql
-- Part 1: PowerShell creating a .LNK file with a remote path

FROM * -- <-- EDR index or data-stream
| WHERE (event.module == "powershell" OR process.name ILIKE "*powershell.exe" OR process.parent.name ILIKE "*powershell.exe")
  AND process.command_line ILIKE "*WScript.Shell*" AND process.command_line ILIKE "*CreateShortcut*"
  AND process.command_line MATCHES_REGEX("(?i)(\\.TargetPath|\\.IconLocation)\\s*=\\s*[\'\"].*?\\\\")
| EVAL DetectionMethod = "PowerShell LNK Creation with Remote Path",
       Evidence = process.command_line,
       SuspiciousProcess = process.name,
       SuspiciousCommandLine = process.command_line
| KEEP @timestamp, host.name, DetectionMethod, Evidence, SuspiciousProcess, SuspiciousCommandLine, user.name

-- Part 2: Explorer.exe connecting to a remote SMB share

FROM *
| WHERE event.category == "network" AND process.name ILIKE "*explorer.exe" AND destination.port == 445
  AND (url MATCHES_REGEX("(?i)\\.(exe|dll|ico)$")
       OR (destination.ip IS NOT NULL
           AND destination.ip NOT IN ("10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16", "127.0.0.1")))
| EVAL DetectionMethod = "Explorer.exe SMB Connection for Remote File",
       Evidence = CONCAT("RemoteUrl: ", url, ", RemoteIP: ", destination.ip),
       SuspiciousProcess = process.name,
       SuspiciousCommandLine = process.command_line
| KEEP @timestamp, host.name, DetectionMethod, Evidence, SuspiciousProcess, SuspiciousCommandLine, user.name

-- Part 3: Explorer.exe creating an executable in a temp location

FROM *
| WHERE event.category == "file" AND process.name ILIKE "*explorer.exe"
  AND (file.name ILIKE "*.exe" OR file.name ILIKE "*.dll")
  AND (file.path ILIKE "*\\AppData\\Local\\Temp\\*" OR file.path ILIKE "*\\AppData\\Local\\Microsoft\\Windows\\INetCache\\*")
| EVAL DetectionMethod = "Explorer.exe Created Executable in Temp Directory",
       Evidence = CONCAT("File: ", file.name, ", Path: ", file.path),
       SuspiciousProcess = process.name,
       SuspiciousCommandLine = process.command_line
| KEEP @timestamp, host.name, DetectionMethod, Evidence, SuspiciousProcess, SuspiciousCommandLine, user.name
```

### Sentinel One
---
```sql
-- Part 1: PowerShell creating a .LNK file with a remote path

EventType IN ("Process Creation", "Process Modification")
AND (SrcProcName:"powershell.exe" OR SrcProcParentName:"powershell.exe")
AND ProcessCmdLine:/WScript\.Shell.*CreateShortcut/i
AND ProcessCmdLine:/(?i)(\.TargetPath|\.IconLocation)\s*=\s*["'].*?\\\\/
| SELECT Time, EndpointName, DetectionMethod="PowerShell LNK Creation with Remote Path", Evidence=ProcessCmdLine, SuspiciousProcess=SrcProcName, SuspiciousCommandLine=ProcessCmdLine, UserName

-- Part 2: Explorer.exe connecting to a remote SMB share

EventType="Network Connect"
AND SrcProcName:"explorer.exe" AND DstPort=445
AND (TargetUrl:/(?i)\.(exe|dll|ico)$/ OR (DstIP NOT IN ("10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16", "127.0.0.1")))
| SELECT Time, EndpointName, DetectionMethod="Explorer.exe SMB Connection for Remote File", Evidence=concat("RemoteUrl: ", TargetUrl, ", RemoteIP: ", DstIP), SuspiciousProcess=SrcProcName, SuspiciousCommandLine=ProcessCmdLine, UserName

-- Part 3: Explorer.exe creating an executable in a temp location

EventType="File Creation"
AND SrcProcName:"explorer.exe"
AND (TgtFileName:/\.exe$/ OR TgtFileName:/\.dll$/)
AND (TgtFilePath:/\\AppData\\Local\\Temp\\/ OR TgtFilePath:/\\AppData\\Local\\Microsoft\\Windows\\INetCache\\/)
| SELECT Time, EndpointName, DetectionMethod="Explorer.exe Created Executable in Temp Directory", Evidence=concat("File: ", TgtFileName, ", Path: ", TgtFilePath), SuspiciousProcess=SrcProcName, SuspiciousCommandLine=ProcessCmdLine, UserName
```