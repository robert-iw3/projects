### Win-DoS Epidemic: Abusing RPC for DoS & DDoS Research
---

SafeBreach Labs has uncovered a "Win-DoS Epidemic" involving four new Windows denial-of-service (DoS) vulnerabilities and a novel distributed denial-of-service (DDoS) technique called Win-DDoS, which weaponizes public Domain Controllers (DCs). These attacks exploit developer blind spots in Windows RPC and LDAP client-side code, allowing unauthenticated or low-privileged attackers to crash critical Windows systems and leverage them as part of a botnet.

The research introduces two significant attack techniques: "Win-DDoS," which transforms public DCs into a powerful, untraceable DDoS botnet by manipulating LDAP referrals, and "TorpeDoS," a method enabling a single attacker machine to achieve DDoS-like impact by optimizing RPC call rates through pre-binding and stateless RPC. These techniques are noteworthy as they bypass traditional botnet requirements and common DDoS mitigations, posing a significant threat to enterprise resilience.

### Actionable Threat Data
---

Unusual Outbound LDAP/CLDAP Traffic from Domain Controllers: Monitor Domain Controllers for unusual outbound LDAP (TCP 389) or CLDAP (UDP 389) connections to external, untrusted IP addresses or a sudden increase in LDAP/CLDAP queries to a single external destination. This could indicate a DC being leveraged as part of a Win-DDoS attack.

High Volume of RPC Binds from a Single Source: Look for an abnormally high rate of RPC bind requests originating from a single source IP address targeting internal Windows machines, especially Domain Controllers, over TCP. The "TorpeDoS" technique involves sending thousands of bind packets upfront to overwhelm the target.

Repeated DsrGetDcNameEx2 RPC Calls: Detect repeated invocations of the DsrGetDcNameEx2 RPC function (used to force DCs to become CLDAP clients) from external or unexpected internal sources. This RPC call is the initial trigger for the Win-DDoS attack chain.

Spike in NetrServerReqChallenge RPC Calls: Monitor for a sudden increase in NetrServerReqChallenge RPC calls (Opnum 4) to Domain Controllers, particularly if these calls are unauthenticated or originate from unusual sources. This function was exploited in CVE-2025-26673 to cause resource exhaustion.

Excessive RpcEnumPrinters RPC Calls with Long Parameters: Identify a high volume of RpcEnumPrinters RPC calls targeting Windows endpoints, especially if the ComputerName parameter is unusually long. This RPC call was abused in CVE-2025-49722 to crash systems, even with authenticated users.

### Query Info
---
Name: Win-DoS and Win-DDoS RPC and LDAP Abuse Techniques

Author: RW

Date: 2025-08-13

Tactic: Impact

Technique: T1498.001 - Endpoint Denial of Service: OS Exhaustion Flood

Description:

This query combines multiple detections for Denial of Service (DoS) and Distributed Denial of Service (DDoS) techniques that abuse Windows RPC and LDAP functionalities, as detailed by SafeBreach research. It identifies high-volume LDAP traffic from DCs (Win-DDoS), excessive RPC bind requests (TorpeDoS), and specific RPC call floods associated with CVE-2025-26673 and CVE-2025-49722.

False Positives: Legitimate administrative, monitoring, or inventory scanning tools may generate activity that resembles these attacks. It is crucial to baseline normal activity and tune the thresholds for each detection module. Consider allowlisting known-good scanners or administrative hosts/accounts where applicable.

### Splunk
---
```sql
-- "Module 1: Win-DDoS - High Volume Outbound LDAP from Domain Controller. This part of the query assumes a CIM compliant data source for network traffic, such as Sysmon EventCode 3."
search (index=* sourcetype=stash) earliest=-15m (tag=network tag=communicate) process_name="lsass.exe" dest_port=389
| where NOT (cidrmatch("10.0.0.0/8", dest) OR cidrmatch("172.16.0.0/12", dest) OR cidrmatch("192.168.0.0/16", dest))
| stats min(_time) as StartTime, max(_time) as EndTime, count as ActivityCount by host, dest
| where ActivityCount > 100
| rename host as TargetDevice, dest as SourceIdentifier
| eval DetectionName="Win-DDoS: High Volume Outbound LDAP"
| eval Description="Potential Win-DDoS attack participation. Device '".TargetDevice."' made ".ActivityCount." outbound LDAP connections to public IP '".SourceIdentifier."'."
| convert ctime(StartTime), ctime(EndTime)
| table StartTime, EndTime, TargetDevice, SourceIdentifier, ActivityCount, DetectionName, Description

| append [
    -- "Module 2: TorpeDoS - High Volume of RPC Bind Requests. This part of the query assumes a CIM compliant data source for network traffic."
    search (index=* sourcetype=stash) earliest=-10m (tag=network tag=communicate) dest_port=135 transport="tcp"
    | stats min(_time) as StartTime, max(_time) as EndTime, count as ActivityCount by host, src
    | where ActivityCount > 500
    | rename host as TargetDevice, src as SourceIdentifier
    | eval DetectionName="TorpeDoS: High Volume RPC Bind Requests"
    | eval Description="Potential TorpeDoS attack. Source '".SourceIdentifier."' established ".ActivityCount." connections to the RPC Endpoint Mapper on '".TargetDevice."'."
    | convert ctime(StartTime), ctime(EndTime)
    | table StartTime, EndTime, TargetDevice, SourceIdentifier, ActivityCount, DetectionName, Description
]

| append [
    -- "Module 3: Win-DDoS - Repeated DsrGetDcNameEx2 RPC Calls. This requires a data source with RPC event details. Field names like 'process_name', 'rpc_interface_uuid', and 'rpc_method' are assumed."
    search (index=* sourcetype=*) earliest=-30m process_name="lsass.exe" rpc_interface_uuid="12345678-1234-abcd-ef00-01234567cffb" rpc_method="DsrGetDcNameEx2"
    | stats min(_time) as StartTime, max(_time) as EndTime, count as ActivityCount by host, src
    | where ActivityCount > 20
    | rename host as TargetDevice, src as SourceIdentifier
    | eval DetectionName="Win-DDoS: DsrGetDcNameEx2 RPC Flood"
    | eval Description="Potential Win-DDoS trigger. Source '".SourceIdentifier."' made ".ActivityCount." DsrGetDcNameEx2 RPC calls to '".TargetDevice."'."
    | convert ctime(StartTime), ctime(EndTime)
    | table StartTime, EndTime, TargetDevice, SourceIdentifier, ActivityCount, DetectionName, Description
]

| append [
    -- "Module 4: Spike in NetrServerReqChallenge RPC Calls (CVE-2025-26673). This requires a data source with RPC event details."
    search (index=* sourcetype=*) earliest=-10m process_name="lsass.exe" rpc_interface_uuid="12345678-1234-abcd-ef00-01234567cffb" (rpc_method="NetrServerReqChallenge" OR rpc_op_num=4)
    | stats min(_time) as StartTime, max(_time) as EndTime, count as ActivityCount by host, src
    | where ActivityCount > 500
    | rename host as TargetDevice, src as SourceIdentifier
    | eval DetectionName="Netlogon DoS (CVE-2025-26673)"
    | eval Description="Potential Netlogon DoS attack. Source '".SourceIdentifier."' made ".ActivityCount." NetrServerReqChallenge RPC calls to '".TargetDevice."'."
    | convert ctime(StartTime), ctime(EndTime)
    | table StartTime, EndTime, TargetDevice, SourceIdentifier, ActivityCount, DetectionName, Description
]

| append [
    -- "Module 5: Excessive RpcEnumPrinters Calls (CVE-2025-49722). This requires a data source with RPC event details."
    search (index=* sourcetype=*) earliest=-10m process_name="spoolsv.exe" rpc_interface_uuid="12345678-1234-abcd-ef00-0123456789ab" rpc_method="RpcEnumPrinters"
    | stats min(_time) as StartTime, max(_time) as EndTime, count as ActivityCount by host, src, user
    | where ActivityCount > 200
    | rename host as TargetDevice, src as SourceIdentifier, user as UserName
    | eval DetectionName="Spooler DoS (CVE-2025-49722)"
    | eval Description="Potential Spooler DoS attack by user '".UserName."' from '".SourceIdentifier."'. Made ".ActivityCount." RpcEnumPrinters calls to '".TargetDevice."'."
    | convert ctime(StartTime), ctime(EndTime)
    | table StartTime, EndTime, TargetDevice, SourceIdentifier, UserName, ActivityCount, DetectionName, Description
]
```

### Crowdstrike
---
```sql
-- Module 1: Win-DDoS - High Volume Outbound LDAP from Domain Controller

event_simpleName=NetworkConnectIP4 processName="lsass.exe" TargetPort=389 Timestamp>="now-15m"
| where !(TargetAddress like "10.%" OR TargetAddress like "172.16.%" OR TargetAddress like "192.168.%")
| groupBy [ComputerName, TargetAddress] compute min(Timestamp) as StartTime, max(Timestamp) as EndTime, count() as ActivityCount
| where ActivityCount > 100
| project TargetDevice=ComputerName, SourceIdentifier=TargetAddress, StartTime=strftime(StartTime), EndTime=strftime(EndTime), ActivityCount, DetectionName="Win-DDoS: High Volume Outbound LDAP", Description="Potential Win-DDoS attack participation. Device '" + TargetDevice + "' made " + ActivityCount + " outbound LDAP connections to public IP '" + SourceIdentifier + "'."

-- Module 2: TorpeDoS - High Volume of RPC Bind Requests

event_simpleName=NetworkConnectIP4 TargetPort=135 Protocol="TCP" Timestamp>="now-10m"
| groupBy [ComputerName, SourceAddress] compute min(Timestamp) as StartTime, max(Timestamp) as EndTime, count() as ActivityCount
| where ActivityCount > 500
| project TargetDevice=ComputerName, SourceIdentifier=SourceAddress, StartTime=strftime(StartTime), EndTime=strftime(EndTime), ActivityCount, DetectionName="TorpeDoS: High Volume RPC Bind Requests", Description="Potential TorpeDoS attack. Source '" + SourceIdentifier + "' established " + ActivityCount + " connections to the RPC Endpoint Mapper on '" + TargetDevice + "'."

-- Module 3: Win-DDoS - Repeated DsrGetDcNameEx2 RPC Calls

event_simpleName=RpcCall ProcessName="lsass.exe" InterfaceUuid="12345678-1234-abcd-ef00-01234567cffb" OperationName="DsrGetDcNameEx2" Timestamp>="now-30m"
| groupBy [ComputerName, SourceAddress] compute min(Timestamp) as StartTime, max(Timestamp) as EndTime, count() as ActivityCount
| where ActivityCount > 20
| project TargetDevice=ComputerName, SourceIdentifier=SourceAddress, StartTime=strftime(StartTime), EndTime=strftime(EndTime), ActivityCount, DetectionName="Win-DDoS: DsrGetDcNameEx2 RPC Flood", Description="Potential Win-DDoS trigger. Source '" + SourceIdentifier + "' made " + ActivityCount + " DsrGetDcNameEx2 RPC calls to '" + TargetDevice + "'."

-- Module 4: Spike in NetrServerReqChallenge RPC Calls (CVE-2025-26673)

event_simpleName=RpcCall ProcessName="lsass.exe" InterfaceUuid="12345678-1234-abcd-ef00-01234567cffb" (OperationName="NetrServerReqChallenge" OR OperationNumber=4) Timestamp>="now-10m"
| groupBy [ComputerName, SourceAddress] compute min(Timestamp) as StartTime, max(Timestamp) as EndTime, count() as ActivityCount
| where ActivityCount > 500
| project TargetDevice=ComputerName, SourceIdentifier=SourceAddress, StartTime=strftime(StartTime), EndTime=strftime(EndTime), ActivityCount, DetectionName="Netlogon DoS (CVE-2025-26673)", Description="Potential Netlogon DoS attack. Source '" + SourceIdentifier + "' made " + ActivityCount + " NetrServerReqChallenge RPC calls to '" + TargetDevice + "'."

-- Module 5: Excessive RpcEnumPrinters Calls (CVE-2025-49722)

event_simpleName=RpcCall ProcessName="spoolsv.exe" InterfaceUuid="12345678-1234-abcd-ef00-0123456789ab" OperationName="RpcEnumPrinters" Timestamp>="now-10m"
| groupBy [ComputerName, SourceAddress, UserName] compute min(Timestamp) as StartTime, max(Timestamp) as EndTime, count() as ActivityCount
| where ActivityCount > 200
| project TargetDevice=ComputerName, SourceIdentifier=SourceAddress, UserName, StartTime=strftime(StartTime), EndTime=strftime(EndTime), ActivityCount, DetectionName="Spooler DoS (CVE-2025-49722)", Description="Potential Spooler DoS attack by user '" + UserName + "' from '" + SourceIdentifier + "'. Made " + ActivityCount + " RpcEnumPrinters calls to '" + TargetDevice + "'."
```

### Datadog
---
```sql
-- Module 1: Win-DDoS - High Volume Outbound LDAP from Domain Controller

(tags:network AND tags:communicate AND process_name:lsass.exe AND destination_port:389) -destination_ip:(10.0.0.0/8 OR 172.16.0.0/12 OR 192.168.0.0/16) @timestamp:>now-15m
| group by host, destination_ip
| select min(@timestamp) as StartTime, max(@timestamp) as EndTime, count() as ActivityCount
| where ActivityCount > 100
| select StartTime=strftime(StartTime), EndTime=strftime(EndTime), TargetDevice=host, SourceIdentifier=destination_ip, ActivityCount, DetectionName="Win-DDoS: High Volume Outbound LDAP", Description="Potential Win-DDoS attack participation. Device '{TargetDevice}' made {ActivityCount} outbound LDAP connections to public IP '{SourceIdentifier}'."

-- Module 2: TorpeDoS - High Volume of RPC Bind Requests

(tags:network AND tags:communicate AND destination_port:135 AND network_transport:tcp) @timestamp:>now-10m
| group by host, source_ip
| select min(@timestamp) as StartTime, max(@timestamp) as EndTime, count() as ActivityCount
| where ActivityCount > 500
| select StartTime=strftime(StartTime), EndTime=strftime(EndTime), TargetDevice=host, SourceIdentifier=source_ip, ActivityCount, DetectionName="TorpeDoS: High Volume RPC Bind Requests", Description="Potential TorpeDoS attack. Source '{SourceIdentifier}' established {ActivityCount} connections to the RPC Endpoint Mapper on '{TargetDevice}'."

-- Module 3: Win-DDoS - Repeated DsrGetDcNameEx2 RPC Calls

(process_name:lsass.exe AND rpc_interface_uuid:12345678-1234-abcd-ef00-01234567cffb AND rpc_method:DsrGetDcNameEx2) @timestamp:>now-30m
| group by host, source_ip
| select min(@timestamp) as StartTime, max(@timestamp) as EndTime, count() as ActivityCount
| where ActivityCount > 20
| select StartTime=strftime(StartTime), EndTime=strftime(EndTime), TargetDevice=host, SourceIdentifier=source_ip, ActivityCount, DetectionName="Win-DDoS: DsrGetDcNameEx2 RPC Flood", Description="Potential Win-DDoS trigger. Source '{SourceIdentifier}' made {ActivityCount} DsrGetDcNameEx2 RPC calls to '{TargetDevice}'."

-- Module 4: Spike in NetrServerReqChallenge RPC Calls (CVE-2025-26673)

(process_name:lsass.exe AND rpc_interface_uuid:12345678-1234-abcd-ef00-01234567cffb AND (rpc_method:NetrServerReqChallenge OR rpc_op_num:4)) @timestamp:>now-10m
| group by host, source_ip
| select min(@timestamp) as StartTime, max(@timestamp) as EndTime, count() as ActivityCount
| where ActivityCount > 500
| select StartTime=strftime(StartTime), EndTime=strftime(EndTime), TargetDevice=host, SourceIdentifier=source_ip, ActivityCount, DetectionName="Netlogon DoS (CVE-2025-26673)", Description="Potential Netlogon DoS attack. Source '{SourceIdentifier}' made {ActivityCount} NetrServerReqChallenge RPC calls to '{TargetDevice}'."

-- Module 5: Excessive RpcEnumPrinters Calls (CVE-2025-49722)

(process_name:spoolsv.exe AND rpc_interface_uuid:12345678-1234-abcd-ef00-0123456789ab AND rpc_method:RpcEnumPrinters) @timestamp:>now-10m
| group by host, source_ip, user
| select min(@timestamp) as StartTime, max(@timestamp) as EndTime, count() as ActivityCount
| where ActivityCount > 200
| select StartTime=strftime(StartTime), EndTime=strftime(EndTime), TargetDevice=host, SourceIdentifier=source_ip, UserName=user, ActivityCount, DetectionName="Spooler DoS (CVE-2025-49722)", Description="Potential Spooler DoS attack by user '{UserName}' from '{SourceIdentifier}'. Made {ActivityCount} RpcEnumPrinters calls to '{TargetDevice}'."
```

### Elastic
---
```sql
-- Module 1: Win-DDoS - High Volume Outbound LDAP from Domain Controller

FROM *
| WHERE @timestamp >= NOW() - INTERVAL 15 MINUTES
AND event.category="network" AND event.action="connection"
AND process.name="lsass.exe" AND destination.port=389
AND NOT destination.ip MATCHES "10.0.0.0/8" AND NOT destination.ip MATCHES "172.16.0.0/12" AND NOT destination.ip MATCHES "192.168.0.0/16"
| STATS StartTime=MIN(@timestamp), EndTime=MAX(@timestamp), ActivityCount=COUNT(*) BY host.hostname, destination.ip
| WHERE ActivityCount > 100
| EVAL TargetDevice=host.hostname, SourceIdentifier=destination.ip, DetectionName="Win-DDoS: High Volume Outbound LDAP", Description=CONCAT("Potential Win-DDoS attack participation. Device '", TargetDevice, "' made ", TO_STRING(ActivityCount), " outbound LDAP connections to public IP '", SourceIdentifier, "'.")
| KEEP StartTime, EndTime, TargetDevice, SourceIdentifier, ActivityCount, DetectionName, Description
| EVAL StartTime=TO_STRING(StartTime), EndTime=TO_STRING(EndTime)

-- Module 2: TorpeDoS - High Volume of RPC Bind Requests

FROM *
| WHERE @timestamp >= NOW() - INTERVAL 10 MINUTES
AND event.category="network" AND event.action="connection"
AND destination.port=135 AND network.transport="tcp"
| STATS StartTime=MIN(@timestamp), EndTime=MAX(@timestamp), ActivityCount=COUNT(*) BY host.hostname, source.ip
| WHERE ActivityCount > 500
| EVAL TargetDevice=host.hostname, SourceIdentifier=source.ip, DetectionName="TorpeDoS: High Volume RPC Bind Requests", Description=CONCAT("Potential TorpeDoS attack. Source '", SourceIdentifier, "' established ", TO_STRING(ActivityCount), " connections to the RPC Endpoint Mapper on '", TargetDevice, "'.")
| KEEP StartTime, EndTime, TargetDevice, SourceIdentifier, ActivityCount, DetectionName, Description
| EVAL StartTime=TO_STRING(StartTime), EndTime=TO_STRING(EndTime)

-- Module 3: Win-DDoS - Repeated DsrGetDcNameEx2 RPC Calls

FROM *
| WHERE @timestamp >= NOW() - INTERVAL 30 MINUTES
AND process.name="lsass.exe" AND rpc.interface_uuid="12345678-1234-abcd-ef00-01234567cffb" AND rpc.method="DsrGetDcNameEx2"
| STATS StartTime=MIN(@timestamp), EndTime=MAX(@timestamp), ActivityCount=COUNT(*) BY host.hostname, source.ip
| WHERE ActivityCount > 20
| EVAL TargetDevice=host.hostname, SourceIdentifier=source.ip, DetectionName="Win-DDoS: DsrGetDcNameEx2 RPC Flood", Description=CONCAT("Potential Win-DDoS trigger. Source '", SourceIdentifier, "' made ", TO_STRING(ActivityCount), " DsrGetDcNameEx2 RPC calls to '", TargetDevice, "'.")
| KEEP StartTime, EndTime, TargetDevice, SourceIdentifier, ActivityCount, DetectionName, Description
| EVAL StartTime=TO_STRING(StartTime), EndTime=TO_STRING(EndTime)

-- Module 4: Spike in NetrServerReqChallenge RPC Calls (CVE-2025-26673)

FROM *
| WHERE @timestamp >= NOW() - INTERVAL 10 MINUTES
AND process.name="lsass.exe" AND rpc.interface_uuid="12345678-1234-abcd-ef00-01234567cffb" AND (rpc.method="NetrServerReqChallenge" OR rpc.op_num=4)
| STATS StartTime=MIN(@timestamp), EndTime=MAX(@timestamp), ActivityCount=COUNT(*) BY host.hostname, source.ip
| WHERE ActivityCount > 500
| EVAL TargetDevice=host.hostname, SourceIdentifier=source.ip, DetectionName="Netlogon DoS (CVE-2025-26673)", Description=CONCAT("Potential Netlogon DoS attack. Source '", SourceIdentifier, "' made ", TO_STRING(ActivityCount), " NetrServerReqChallenge RPC calls to '", TargetDevice, "'.")
| KEEP StartTime, EndTime, TargetDevice, SourceIdentifier, ActivityCount, DetectionName, Description
| EVAL StartTime=TO_STRING(StartTime), EndTime=TO_STRING(EndTime)

-- Module 5: Excessive RpcEnumPrinters Calls (CVE-2025-49722)

FROM *
| WHERE @timestamp >= NOW() - INTERVAL 10 MINUTES
AND process.name="spoolsv.exe" AND rpc.interface_uuid="12345678-1234-abcd-ef00-0123456789ab" AND rpc.method="RpcEnumPrinters"
| STATS StartTime=MIN(@timestamp), EndTime=MAX(@timestamp), ActivityCount=COUNT(*) BY host.hostname, source.ip, user.name
| WHERE ActivityCount > 200
| EVAL TargetDevice=host.hostname, SourceIdentifier=source.ip, UserName=user.name, DetectionName="Spooler DoS (CVE-2025-49722)", Description=CONCAT("Potential Spooler DoS attack by user '", UserName, "' from '", SourceIdentifier, "'. Made ", TO_STRING(ActivityCount), " RpcEnumPrinters calls to '", TargetDevice, "'.")
| KEEP StartTime, EndTime, TargetDevice, SourceIdentifier, UserName, ActivityCount, DetectionName, Description
| EVAL StartTime=TO_STRING(StartTime), EndTime=TO_STRING(EndTime)
```

### Sentinel One
---
```sql
-- Module 1: Win-DDoS - High Volume Outbound LDAP from Domain Controller

EventType=Network AND ProcessName="lsass.exe" AND DstPort=389 AND TimeStamp>="now-15m"
AND NOT (DstIP LIKE "10.%" OR DstIP LIKE "172.16.%" OR DstIP LIKE "192.168.%")
| GROUP BY EndpointName, DstIP
| SELECT MIN(TimeStamp) AS StartTime, MAX(TimeStamp) AS EndTime, COUNT(*) AS ActivityCount
| WHERE ActivityCount > 100
| SELECT TargetDevice=EndpointName, SourceIdentifier=DstIP, StartTime=STRFTIME(StartTime), EndTime=STRFTIME(EndTime), ActivityCount, DetectionName="Win-DDoS: High Volume Outbound LDAP", Description="Potential Win-DDoS attack participation. Device '" + TargetDevice + "' made " + ActivityCount + " outbound LDAP connections to public IP '" + SourceIdentifier + "'."

-- Module 2: TorpeDoS - High Volume of RPC Bind Requests

EventType=Network AND DstPort=135 AND Protocol="TCP" AND TimeStamp>="now-10m"
| GROUP BY EndpointName, SrcIP
| SELECT MIN(TimeStamp) AS StartTime, MAX(TimeStamp) AS EndTime, COUNT(*) AS ActivityCount
| WHERE ActivityCount > 500
| SELECT TargetDevice=EndpointName, SourceIdentifier=SrcIP, StartTime=STRFTIME(StartTime), EndTime=STRFTIME(EndTime), ActivityCount, DetectionName="TorpeDoS: High Volume RPC Bind Requests", Description="Potential TorpeDoS attack. Source '" + SourceIdentifier + "' established " + ActivityCount + " connections to the RPC Endpoint Mapper on '" + TargetDevice + "'."

-- Module 3: Win-DDoS - Repeated DsrGetDcNameEx2 RPC Calls

EventType=RpcCall AND ProcessName="lsass.exe" AND RpcInterfaceUuid="12345678-1234-abcd-ef00-01234567cffb" AND RpcMethod="DsrGetDcNameEx2" AND TimeStamp>="now-30m"
| GROUP BY EndpointName, SrcIP
| SELECT MIN(TimeStamp) AS StartTime, MAX(TimeStamp) AS EndTime, COUNT(*) AS ActivityCount
| WHERE ActivityCount > 20
| SELECT TargetDevice=EndpointName, SourceIdentifier=SrcIP, StartTime=STRFTIME(StartTime), EndTime=STRFTIME(EndTime), ActivityCount, DetectionName="Win-DDoS: DsrGetDcNameEx2 RPC Flood", Description="Potential Win-DDoS trigger. Source '" + SourceIdentifier + "' made " + ActivityCount + " DsrGetDcNameEx2 RPC calls to '" + TargetDevice + "'."

-- Module 4: Spike in NetrServerReqChallenge RPC Calls (CVE-2025-26673)

EventType=RpcCall AND ProcessName="lsass.exe" AND RpcInterfaceUuid="12345678-1234-abcd-ef00-01234567cffb" AND (RpcMethod="NetrServerReqChallenge" OR RpcOpNum=4) AND TimeStamp>="now-10m"
| GROUP BY EndpointName, SrcIP
| SELECT MIN(TimeStamp) AS StartTime, MAX(TimeStamp) AS EndTime, COUNT(*) AS ActivityCount
| WHERE ActivityCount > 500
| SELECT TargetDevice=EndpointName, SourceIdentifier=SrcIP, StartTime=STRFTIME(StartTime), EndTime=STRFTIME(EndTime), ActivityCount, DetectionName="Netlogon DoS (CVE-2025-26673)", Description="Potential Netlogon DoS attack. Source '" + SourceIdentifier + "' made " + ActivityCount + " NetrServerReqChallenge RPC calls to '" + TargetDevice + "'."

-- Module 5: Excessive RpcEnumPrinters Calls (CVE-2025-49722)

EventType=RpcCall AND ProcessName="spoolsv.exe" AND RpcInterfaceUuid="12345678-1234-abcd-ef00-0123456789ab" AND RpcMethod="RpcEnumPrinters" AND TimeStamp>="now-10m"
| GROUP BY EndpointName, SrcIP, UserName
| SELECT MIN(TimeStamp) AS StartTime, MAX(TimeStamp) AS EndTime, COUNT(*) AS ActivityCount
| WHERE ActivityCount > 200
| SELECT TargetDevice=EndpointName, SourceIdentifier=SrcIP, UserName, StartTime=STRFTIME(StartTime), EndTime=STRFTIME(EndTime), ActivityCount, DetectionName="Spooler DoS (CVE-2025-49722)", Description="Potential Spooler DoS attack by user '" + UserName + "' from '" + SourceIdentifier + "'. Made " + ActivityCount + " RpcEnumPrinters calls to '" + TargetDevice + "'."
```