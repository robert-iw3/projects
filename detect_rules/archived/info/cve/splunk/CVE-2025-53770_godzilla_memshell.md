### SharePoint of no Return: Analyzing the Godzilla Webshell (CVE-2025-53770 & CVE-2025-53771 exploitation)
---

This report details the exploitation of SharePoint vulnerabilities CVE-2025-53770 and CVE-2025-53771, which enable remote code execution and the deployment of the stealthy, in-memory Godzilla webshell. The attack chain involves initial access through a crafted POST request, followed by the loading of malicious CLR modules for persistent control and data exfiltration.

Recent intelligence indicates that CVE-2025-53770 and CVE-2025-53771 are patch bypasses for previously disclosed SharePoint vulnerabilities (CVE-2025-49704 and CVE-2025-49706), highlighting the evolving nature of these threats and the need for robust, continuous patching and monitoring beyond initial fixes.

### Actionable Threat Data
---

Look for unexpected CLR modules being loaded into `w3wp.exe` (IIS worker process) memory, such as `LoadLibrary`, `RemoteExec`, `FileList`, `ProcessList`, or `Information`.

Identify unusual `POST` requests to rarely used `.aspx` routes on SharePoint servers containing large `__VIEWSTATE` parameters or other suspicious fields like `__FIXEDPATH`, `__SCROLLPOSITION`, or `__SCROLLPATH`.

Monitor for `csc.exe` compiling `.aspx` files in `C:\Windows\Microsoft.NET\Framework64\<.NET version>\Temporary ASP.NET Files\root\<random>\<random>\App_Web_<filename>.dll`.

### Unexpected CLR Module Load
---
```sql
`comment("
Name: Godzilla Webshell CLR Module Load
Author: Rob Weber
Date: 2025-07-25
References:
    - https://kerberpoasting.medium.com/sharepoint-of-no-return-analysing-the-godzilla-webshell-cve-2025-53770-cve-2025-53771-a4e8e6a74bd1
Description:
    Detects the loading of suspicious CLR modules into the IIS worker process (w3wp.exe).
    These modules are known extensions for the Godzilla in-memory webshell, often used after exploiting SharePoint vulnerabilities.
Data Source:
    This query relies on EDR data (e.g., Sysmon EventID 7) mapped to the Splunk Endpoint data model.
")`

tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime values(Processes.module_load) as suspicious_modules from datamodel=Endpoint.Processes
where
  # Filter for the IIS worker process
  Processes.process_name="w3wp.exe"
  # Filter for known Godzilla webshell module names
  AND (Processes.module_load IN ("*LoadLibrary*", "*RemoteExec*", "*FileList*", "*ProcessList*", "*Information*"))
by Processes.dest, Processes.user, Processes.process_name, Processes.process
| `drop_dm_object_name("Processes")`
| rename dest as host
| convert ctime(firstTime), ctime(lastTime)
# Some module names (e.g., 'Information', 'FileList') can be generic.
# If false positives occur, investigate the full path of the loaded module.
# Consider creating an allowlist for known-good applications if these modules are used legitimately in your environment.
```

### Unusual POST to ASPX Route
---
```sql
`comment("
Name: Godzilla Webshell POST to Unusual ASPX Route
Author: Rob Weber
Date: 2025-07-25
References:
    - https://kerberpoasting.medium.com/sharepoint-of-no-return-analysing-the-godzilla-webshell-cve-2025-53770-cve-2025-53771-a4e8e6a74bd1
Description:
    Detects unusual POST requests to rarely used .aspx routes on SharePoint servers.
    The detection looks for specific form fields (__FIXEDPATH, __SCROLLPOSITION, __SCROLLPATH) used as arguments by Godzilla webshell modules.
    It also looks for POST requests with an abnormally large body containing __VIEWSTATE, which can indicate a .NET deserialization payload used to load the webshell.
Data Source:
    This query relies on web server logs (e.g., IIS) mapped to the Splunk Web data model.
")`

from datamodel=Web.Web
# Filter for POST requests to ASPX pages, a common vector for this attack.
where Web.http_method="POST" AND Web.url="*.aspx"
# Identify requests with suspicious parameters used by Godzilla webshell modules
# OR requests with a large form body, which could indicate a serialized object payload.
# The length threshold may need tuning for your environment to avoid false positives from legitimate, large POST requests.
| eval form_data_len=len(Web.form_data)
| where (Web.form_data LIKE "%__FIXEDPATH%" OR Web.form_data LIKE "%__SCROLLPOSITION%" OR Web.form_data LIKE "%__SCROLLPATH%") OR (Web.form_data LIKE "%__VIEWSTATE%" AND form_data_len > 4096)
# Group by the destination host and URL to identify unusual/rare endpoints.
| stats count as total_requests, values(Web.src) as src_ips, values(Web.user) as users, min(_time) as firstTime, max(_time) as lastTime by Web.dest, Web.url
# The threshold for total_requests is used to identify "rarely used" routes.
# This value may need to be adjusted based on the environment's baseline activity for specific ASPX pages.
| where total_requests < 10
| convert ctime(firstTime), ctime(lastTime)
| rename Web.dest as dest_host, Web.url as suspicious_url
| `godzilla_webshell_post_to_unusual_aspx_route_filter`
```

### CSC.exe Compiling ASPX
---
```sql
`comment("
Name: Malicious ASPX File Compilation by csc.exe
Author: Rob Weber
Date: 2025-07-25
References:
    - https://kerberpoasting.medium.com/sharepoint-of-no-return-analysing-the-godzilla-webshell-cve-2025-53770-cve-2025-53771-a4e8e6a74bd1
MITRE: T1027, T1059
Description:
    Detects the .NET compiler (csc.exe) creating a DLL from a source file located in a temporary ASP.NET compilation directory.
    This behavior is expected for normal ASP.NET operations but is also a strong indicator of a webshell being deployed,
    as seen with the Godzilla webshell after exploiting SharePoint vulnerabilities.
Data Source:
    This query relies on EDR data (e.g., Sysmon EventID 1) mapped to the Splunk Endpoint data model.
")`

from datamodel=Endpoint.Processes
# Filter for the .NET compiler process.
where Processes.process_name = "csc.exe"
# Filter for command lines that indicate compilation of temporary ASP.NET files.
# This is a strong indicator but may generate noise from legitimate application updates or deployments.
# Consider filtering for specific suspicious source file names if known (e.g., spinstall0.aspx).
AND (Processes.process LIKE "%\\Temporary ASP.NET Files\\%" AND Processes.process LIKE "%App_Web_%.dll%")
# Group events by host and command line to reduce alert volume.
| stats count min(_time) as firstTime max(_time) as lastTime by Processes.dest, Processes.user, Processes.parent_process_name, Processes.process
| `drop_dm_object_name("Processes")`
| rename dest as host
| convert ctime(firstTime), ctime(lastTime)
| `malicious_aspx_file_compilation_by_csc.exe_filter`
```
