%YAML 1.1
---

# Suricata configuration example for detecting Salt Typhoon/UNC4841 TTPs
# This configuration includes rules and settings to monitor for activity associated with the Salt Typhoon threat actor

# Basic Suricata configuration
default-log-dir: /var/log/suricata/
default-rule-path: /etc/suricata/rules/

# Define address groups for Salt Typhoon/UNC4841 IPs
vars:
  address-groups:
    HOME_NET: "[192.168.0.0/16,10.0.0.0/8,172.16.0.0/12]"  # Adjust to your internal network
    EXTERNAL_NET: "!$HOME_NET"
    SALT_TYPH00N_IPS: "/etc/suricata/data/salt_typhoon_ips.txt"  # Path to IP list file

# Rule files to load
rule-files:
  - salt_typhoon_unc4841.rules  # Load the Salt Typhoon/UNC4841 rules

# Enable DNS and HTTP protocol inspection
app-layer:
  protocols:
    dns:
      enabled: yes
      detection-ports:
        dp: 53
    http:
      enabled: yes
      libhtp:
        default-config:
          personality: IDS
          request-body-limit: 0
          response-body-limit: 0

# Output configuration for alerts and logs
outputs:
  # EVE JSON output for alerts and events
  - eve-log:
      enabled: yes
      filetype: regular
      filename: eve.json
      types:
        - alert:
            payload: yes
            packet: yes
            metadata: yes
        - dns:
            query: yes
            answer: yes
        - http:
            extended: yes

# Packet capture settings
af-packet:
  - interface: eth0  # Adjust to your network interface
    threads: auto
    defrag: yes
    cluster-type: cluster_flow
    cluster-id: 99
    buffer-size: 32768

# Logging settings
logging:
  default-log-level: info
  outputs:
    - console:
        enabled: yes
    - file:
        enabled: yes
        filename: /var/log/suricata/suricata.log

# Host OS settings (adjust as needed)
host-os-policy:
  linux: 0.0.0.0/0

# Enable detection mode
detect-engine:
  - profile: medium
  - custom-values:
      toclient-groups: 200
      toserver-groups: 200
  - sgh-mpm-context: auto
  - inspection-recursion-limit: 0

# Threading configuration
threading:
  set-cpu-affinity: no
  cpu-affinity:
    - management-cpu-set:
        cpu: [ "0" ]
    - worker-cpu-set:
        cpu: [ "0-3" ]  # Adjust based on CPU cores
  detect-thread-ratio: 1.0

# Notes:
# - Place salt_typhoon_unc4841.rules and salt_typhoon_ips.txt in /etc/suricata/rules/ and /etc/suricata/data/, respectively.
# - Adjust HOME_NET to match your internal network CIDR blocks.
# - Update af-packet interface (e.g., eth0) to your network interface.
# - EVE JSON output includes alerts, DNS queries, and HTTP traffic for correlation and historical analysis (recommended for 5-year log review as per article).
# - Test with dns-spoof or tcpreplay to simulate traffic to listed domains/IPs.
# - For HTTPS inspection, enable TLS in app-layer if SSL decryption is available.
# - Consider adding threshold rules (e.g., threshold: type both, track by_src, count 1, seconds 300) to reduce noise in high-traffic environments.