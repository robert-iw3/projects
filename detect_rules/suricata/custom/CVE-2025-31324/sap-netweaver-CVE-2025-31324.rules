# Author: Rob Weber
# https://redcanary.com/blog/threat-intelligence/cve-2025-31324/
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"SAP NetWeaver Potential JSP Web Shell Upload Detected (CVE-2025-31324)"; \
    flow:to_server,established; http.method; content:"POST"; http.uri; \
    pcre:"/j2ee\\/cluster\\/apps\\/sap\\.com\\/irj\\/servlet_jsp\\/irj\\/(root|work|work\\/sync)\\/.*?\.jsp/i"; \
    http.request_body; content:"<jsp:include"; nocase; content:"<%@page"; nocase; content:"java.io"; \
    nocase; distance:0; within:1000; classtype:web-application-attack; sid:8362002; rev:1;)
# known bad traffic ioc's
alert ip $HOME_NET any -> 5.161.153.112 any (msg:"SAP NetWeaver - Suspicious Outbound Connection (CVE-2025-31324 IOC)"; \
    flow:to_server,established; classtype:bad-unknown; sid:8362003; rev:1;)
alert ip $HOME_NET any -> 23.95.123.5 any (msg:"SAP NetWeaver - Suspicious Outbound Connection (CVE-2025-31324 IOC)"; \
    flow:to_server,established; classtype:bad-unknown; sid:8362004; rev:1;)
alert dns $HOME_NET any -> any any (msg:"SAP NetWeaver - Suspicious DNS Query (CVE-2025-31324 IOC)"; \
    dns.query; content:"brandnav-cms-storage.s3.amazonaws.com"; nocase; \
    content:"abode-dashboard-media.s3.ap-south-1.amazonaws.com"; nocase; \
    content:"overseas-recognized-athens-oakland.trycloudflare.com"; nocase; \
    content:"ocr-freespace.oss-cn-beijing.aliyuncs.com"; nocase; \
    content:"devocional.click"; nocase; \
    content:"update.zoho-software.com"; nocase; \
    classtype:trojan-activity; sid:8362005; rev:1;)
alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"SAP NetWeaver - Suspicious TLS SNI (CVE-2025-31324 IOC)"; \
    tls.sni; content:"brandnav-cms-storage.s3.amazonaws.com"; nocase; \
    content:"abode-dashboard-media.s3.ap-south-1.amazonaws.com"; nocase; \
    content:"overseas-recognized-athens-oakland.trycloudflare.com"; nocase; \
    content:"ocr-freespace.oss-cn-beijing.aliyuncs.com"; nocase; \
    content:"devocional.click"; nocase; \
    content:"update.zoho-software.com"; nocase; \
    classtype:bad-unknown; sid:8362006; rev:1;)
# using datasets
#alert ip $HOME_NET any -> any any (msg:"SAP NetWeaver - Suspicious Outbound IP Connection (CVE-2025-31324)"; \
#    dataset:isset, suspicious_ips_cve_2025_31324, type ip; flow:to_server,established; \
#    classtype:bad-unknown; sid:8362007; rev:1;)
#alert dns $HOME_NET any -> any any (msg:"SAP NetWeaver - Suspicious DNS Query (CVE-2025-31324)"; \
#    dns.query; dataset:isset, suspicious_domains_cve_2025_31324, type string; \
#    classtype:trojan-activity; sid:8362008; rev:1;)
#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg:"SAP NetWeaver - Suspicious TLS SNI (CVE-2025-31324)"; \
#    tls.sni; dataset:isset, suspicious_domains_cve_2025_31324, type string; \
#    classtype:bad-unknown; sid:8362009; rev:1;)

