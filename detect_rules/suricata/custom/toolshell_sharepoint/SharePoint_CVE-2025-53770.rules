# author: Rob Weber
# https://www.microsoft.com/en-us/security/blog/2025/07/22/disrupting-active-exploitation-of-on-premises-sharepoint-vulnerabilities/
# known malicious domains
alert dns any any -> any any (msg:"Possible DNS query for c34718cbb4c6.ngrok-free.app (CVE-2025-53770)"; \
    dns.query; content:"c34718cbb4c6.ngrok-free.app"; nocase; sid:7320001; rev:1;)
alert dns any any -> any any (msg:"Possible DNS query for msupdate.updatemicfosoft.com (CVE-2025-53770)"; \
    dns.query; content:"msupdate.updatemicfosoft.com"; nocase; sid:7320002; rev:1;)
alert dns any any -> any any (msg:"Possible DNS query for dynastyjusticecollective.site (CVE-2025-53770)"; \
    dns.query; content:"dynastyjusticecollective.site"; nocase; sid:7320003; rev:1;)
# toolpane.aspx exploit
alert http any any -> any any (msg:"SharePoint ToolPane/SignOut access via HTTP POST (CVE-2025-53770)"; \
    flow:established,to_server; http.method; content:"POST"; http.uri; \
    pcre:"/\/(_layouts\/15\/ToolPane\.aspx|\/_layouts\/SignOut\.aspx|\/_layouts\/16\/ToolPane\.aspx|\/_layouts\/SignOut.*|\/_layouts\/.*\/ToolPane.*)/i"; \
    sid:7320004; rev:1;)
# known malicious IP's
# inbound
alert ip any any -> $HOME_NET any (msg:"Possible malicious inbound connection from known bad IP (CVE-2025-53770)"; \
    dataset:isset, malicious_ips_cve_2025_53770, type ip; flow:to_server,established; \
    classtype:bad-unknown; sid:7320005; rev:1;)
# outbound
alert ip $HOME_NET any -> any any (msg:"Possible outbound connection to known bad IP (CVE-2025-53770)"; \
    dataset:isset, malicious_ips_cve_2025_53770, type ip; flow:to_client,established; \
    classtype:bad-unknown; sid:7320006; rev:1;)