alert ip $HOME_NET any -> $EXTERNAL_NET !20,21,22,23,25,53,80,110,123,135,137,138,139,143,443,445,465,587,993,995,1433,1521,3306,3389,5060,5061,5900,8080,8443 \
(msg:"C2 Communication Over Non-Standard Port"; flow:established,to_server; \
app-layer-protocol:!http,!ssl,!dns,!smtp,!pop3,!imap,!ntp,!sip; classtype:suspicious-traffic; sid:1000003; rev:1; \
metadata:author RW, description "Detects outbound connections to non-standard ports potentially used for C2 communication, excluding common ports and legitimate application traffic", tags T1571,T1071, severity Medium, false_positives "P2P apps, online games, legitimate remote admin or collaboration tools may use custom ports, tune common ports and process allowlist to reduce false positives";)